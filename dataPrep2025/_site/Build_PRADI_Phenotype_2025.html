<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>PRADI Data Prep 2025</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Build_WRAP_Phenotype_2025.html">WRAP</a>
</li>
<li>
  <a href="Build_PRADI_Phenotype_2025.html">PRADI</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">PRADI Data Prep 2025</h1>

</div>


<p>Author: Mengna Zhang</p>
<p><em>Last updated on:</em> 2025-08-13</p>
<div id="set-path" class="section level1">
<h1>Set Path</h1>
<pre class="r"><code>#directory
directory &lt;- &quot;/Users/mengnazhang/Desktop/&quot;
my_directory &lt;- paste0(directory, &quot;ADSP_DataPrep_local/PRADI/Phenotype/2025/Raw/&quot;)

## colnames excel file location
colnames_file &lt;- &quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;</code></pre>
<p><br></p>
</div>
<div id="load-packages" class="section level1">
<h1>Load Packages</h1>
<pre class="r"><code>require(dplyr)
require(readxl)
require(openxlsx)
require(stringr)</code></pre>
<p><br></p>
</div>
<div id="load-helper-scripts" class="section level1">
<h1>Load Helper Scripts</h1>
<pre class="r"><code>source(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep/dataPrep2025/helperScripts.R&quot;)</code></pre>
<p><br> <br></p>
</div>
<div id="sub-files-inspection" class="section level1">
<h1>Sub Files Inspection</h1>
<div id="save-all-sub-file-names" class="section level2">
<h2>Save all sub file names</h2>
<p><strong>Extract all file names</strong></p>
<pre class="bash"><code>mypath=&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Raw/&quot;

ls ${mypath} | grep &quot;.xlsx&quot; &gt; ${mypath}filelist.txt

wc -l ${mypath}filelist.txt ## 38 sub files in total</code></pre>
<pre><code>      38 /Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Raw/filelist.txt</code></pre>
<p><br> <br></p>
</div>
<div id="load-all-subfiles" class="section level2">
<h2>Load All Subfiles</h2>
<pre class="r"><code>file_list &lt;- paste0(my_directory,&quot;filelist.txt&quot;)

## read all lines (file names) from the file
file_names &lt;- readLines(file_list)

## loop over each file name
for (fname in file_names) {
  ## Extract the clean name by removing prefix and suffix
  clean_name &lt;- sub(&quot;^PRADI_&quot;, &quot;&quot;, fname)
  clean_name &lt;- sub(&quot;_05122025\\.xlsx$&quot;, &quot;&quot;, clean_name)
  
  ## read the Excel file and convert to data.frame
  data &lt;- as.data.frame(read_excel(paste0(my_directory, fname),sheet = &quot;Export Worksheet&quot;))
  
  ## assign to a variable with the clean name in the global environment
  assign(clean_name, data, envir = .GlobalEnv)
  rm(data)
}</code></pre>
<p><br> <br></p>
</div>
<div id="get-common-columns" class="section level2">
<h2>Get Common Columns</h2>
<pre class="r"><code>df_names &lt;- ls()[sapply(mget(ls(), .GlobalEnv), is.data.frame)]

## extract the column names for each data frame
column_lists &lt;- lapply(df_names, function(name) colnames(get(name)))

## find common columns across all data frames
common_cols &lt;- Reduce(intersect, column_lists)

# Print the result
print(common_cols)</code></pre>
<pre><code>##  [1] &quot;SYSXM&quot;         &quot;SYSIND&quot;        &quot;SYSGP&quot;         &quot;SYSGPSTUDY&quot;   
##  [5] &quot;SYSINDGP&quot;      &quot;CGI_ORDER&quot;     &quot;GPS_ORDER&quot;     &quot;STDCGI_ORDER&quot; 
##  [9] &quot;LSTUDY&quot;        &quot;DB_OWNER&quot;      &quot;STUDY&quot;         &quot;SUBSTUDY&quot;     
## [13] &quot;CENTER&quot;        &quot;GP&quot;            &quot;IND&quot;           &quot;REFCTR&quot;       
## [17] &quot;DATE_OF_BIRTH&quot;</code></pre>
<p><br> <br></p>
</div>
<div id="save-all-colnames" class="section level2">
<h2>Save all Colnames</h2>
<pre class="r"><code>## this code only need to be run once
# Create a new workbook
wb &lt;- createWorkbook()

# For each data frame, add a sheet with its column names
# Loop through each data frame
for (df_name in df_names) {
  df &lt;- get(df_name)  # get the actual data frame
  col_names_df &lt;- data.frame(VarNames = colnames(df))  # create single-column df

  # Add sheet with df name (truncated to 31 characters max)
  sheet_name &lt;- substr(df_name, 1, 31)
  addWorksheet(wb, sheetName = sheet_name)

  # Write the column names into the sheet
  writeData(wb, sheet = sheet_name, col_names_df)
}

# Save the workbook
saveWorkbook(wb, file = colnames_file, overwrite = TRUE)</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="variable-check-per-file" class="section level1">
<h1>Variable Check Per File</h1>
<div id="aaad_geriat" class="section level2">
<h2>AAAD_GERIAT</h2>
<pre class="r"><code>df &lt;- AAAD_GERIAT

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    1051 obs. of  62 variables:
##  $ SYSXM              : num  7534713 7540453 7540583 7540653 7540803 ...
##  $ SYSIND             : num  11108883 11006263 11048913 11048883 11059623 ...
##  $ SYSGP              : num  7920393 7888673 7896183 7896183 7897223 ...
##  $ SYSGPSTUDY         : num  1357713 1304013 1311503 1311503 1312543 ...
##  $ SYSINDGP           : num  7868403 7761063 7804773 7804743 7818553 ...
##  $ CGI_ORDER          : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER          : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER       : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY             : chr  &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ DB_OWNER           : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY              : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY           : chr  &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ CENTER             : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP                 : num  87634 87534 87657 87657 87699 ...
##  $ IND                : num  1 104 102 1000 101 108 1 1 1 1 ...
##  $ REFCTR             : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE          : POSIXct, format: &quot;2018-01-12&quot; &quot;2018-02-21&quot; ...
##  $ EXAMINER           : chr  &quot;axr1589&quot; &quot;v.rodriguez4&quot; &quot;v.rodriguez4&quot; &quot;axr1589&quot; ...
##  $ DATE_OF_BIRTH      : POSIXct, format: &quot;1950-06-03&quot; &quot;1936-09-20&quot; ...
##  $ AGE_AT_EXAM        : num  67 81 72 94 88 68 67 71 68 69 ...
##  $ SATISFIED_LIFE     : chr  &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; ...
##  $ DROPPED_ACTIVITIES : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ FEEL_EMPTY         : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ GOOD_SPIRIT        : chr  &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; ...
##  $ AFRAID_BAD_THINGS  : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ BORED              : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;Y&quot; ...
##  $ FEEL_HAPPY         : chr  &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; ...
##  $ FEEL_HELPLESS      : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ STAY_HOME          : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ MEMORY_PROBLEM     : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ ALIVE              : chr  &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; ...
##  $ FEEL_WORTHLESS     : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ FEEL_FULL_ENERGY   : chr  &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; ...
##  $ FEEL_HOPELESS      : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ OTHER_BETTER_OFF   : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ TROUBLE_FALL_ASLEEP: logi  NA NA NA NA NA NA ...
##  $ TROUBLE_STAY_ASLEEP: logi  NA NA NA NA NA NA ...
##  $ SLEEPING_TOO_MUCH  : logi  NA NA NA NA NA NA ...
##  $ APPETITE_INCREASED : logi  NA NA NA NA NA NA ...
##  $ APPETITE_DECREASED : logi  NA NA NA NA NA NA ...
##  $ WEIGHT_LOSS        : logi  NA NA NA NA NA NA ...
##  $ AMOUNT_WEIGHT_LOSS : logi  NA NA NA NA NA NA ...
##  $ SATISFYING_LIFE    : logi  NA NA NA NA NA NA ...
##  $ COMMENTS           : logi  NA NA NA NA NA NA ...
##  $ RELIABLE           : logi  NA NA NA NA NA NA ...
##  $ LIFE_SCORE         : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ ACTIVITY_SCORE     : num  0 0 0 0 1 0 0 0 1 1 ...
##  $ EMPTY_SCORE        : num  0 0 0 0 0 0 0 0 0 1 ...
##  $ BORED_SCORE        : num  0 0 0 1 0 0 0 0 0 0 ...
##  $ SPIRIT_SCORE       : num  0 0 0 0 0 0 0 0 0 1 ...
##  $ AFRAID_SCORE       : num  0 0 0 0 0 0 0 0 1 0 ...
##  $ HAPPY_SCORE        : num  0 0 0 0 0 0 1 0 0 0 ...
##  $ HELPLESS_SCORE     : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ STAY_HOME_SCORE    : num  0 0 0 0 1 1 0 0 1 0 ...
##  $ MEMORY_SCORE       : num  0 0 0 0 1 0 0 0 0 1 ...
##  $ ALIVE_SCORE        : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ WORTHLESS_SCORE    : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ FULL_ENERGY_SCORE  : num  0 0 0 0 0 0 0 0 0 1 ...
##  $ HOPELESS_SCORE     : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ BETTER_OFF_SCORE   : num  0 0 0 0 0 0 1 0 0 1 ...
##  $ TOTAL_STATUS       : chr  NA NA NA NA ...
##  $ TOTAL              : num  0 0 0 1 3 1 2 0 3 6 ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;AAAD_GERIAT&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## 11 vars 

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 11 × 2
##    VarNames            `Data Type`
##    &lt;chr&gt;               &lt;chr&gt;      
##  1 REFCTR              VARCHAR2(6)
##  2 TROUBLE_FALL_ASLEEP &lt;NA&gt;       
##  3 TROUBLE_STAY_ASLEEP &lt;NA&gt;       
##  4 SLEEPING_TOO_MUCH   &lt;NA&gt;       
##  5 APPETITE_INCREASED  &lt;NA&gt;       
##  6 APPETITE_DECREASED  &lt;NA&gt;       
##  7 WEIGHT_LOSS         &lt;NA&gt;       
##  8 AMOUNT_WEIGHT_LOSS  &lt;NA&gt;       
##  9 SATISFYING_LIFE     &lt;NA&gt;       
## 10 COMMENTS            &lt;NA&gt;       
## 11 RELIABLE            &lt;NA&gt;</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;-c(&quot;REFCTR&quot;)

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;logical&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot; 

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH
## 1 2018-01-12    1950-06-03
## 2 2018-02-21    1936-09-20
## 3 2018-02-19    1946-01-11
## 4 2018-02-19    1923-04-17
## 5 2018-02-18    1929-10-08
## 6 2018-02-19    1949-08-01</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;      &quot;logical&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)]
## 23 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-577430916a2244bcfa01" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-577430916a2244bcfa01">{"x":{"filter":"none","vertical":false,"data":[["EXAMINER"],["EXAMINER"],["axr1589, v.rodriguez4, bxf258, avg55, ALEJANDRA BETACOURT, kxc672, RDW, sjt82, plb50, ascott2, prm72, mxp1257, erika negro, mxc2207, Erika Negro, MP, AS, PM, OG, M. prough, patricia, NIT, MICHAEL P, M PROUGH, UCC, CDel, NEREIDA FELICIANO, erica, erika, Maricarmen Contreras, xx, fxs121, MEDICAL RECORDS, jjs2031, axl4132, jmv184, cmanrique, gsv32, rmartinez1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore EXAMINER, as I assume we can have multiple examiners</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 27 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA              &quot;1 thru 99999;&quot; &quot;1 thru 9999;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-8ef6ea61ad799ec0b45d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8ef6ea61ad799ec0b45d">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104406, 104418, 104420, 104446, 104442, 104423, 104457, 104438, 104419, 104409, 104404, 104431, 104456, 104433, 104425, 104434, 104402, 104501, 104403, 104436, 104413, 104440, 104430, 104424, 104415, 104443, 104441, 104414, 104444, 104422, 104428, 104435, 104437, 104412, 104411, 104408, 104407, 104432, 104439, 104445, 104427, 104410, 104426, 104466, 104477, 104711"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_AAAD_GERIAT &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="aaad_medcon" class="section level2">
<h2>AAAD_MEDCON</h2>
<pre class="r"><code>df &lt;- AAAD_MEDCON

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    397 obs. of  256 variables:
##  $ SYSXM                     : num  7134193 7839953 7838803 7838853 7838933 ...
##  $ SYSIND                    : num  11010563 11368403 11368463 11368453 11368443 ...
##  $ SYSGP                     : num  7889553 7950923 7950983 7950973 7950963 ...
##  $ SYSGPSTUDY                : num  1304893 1396033 1396093 1396083 1396073 ...
##  $ SYSINDGP                  : num  7765583 8137673 8137733 8137723 8137713 ...
##  $ CGI_ORDER                 : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER                 : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER              : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY                    : chr  &quot;ADFAMPRADI&quot; &quot;ADCONTROL&quot; &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ DB_OWNER                  : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY                     : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY                  : chr  &quot;ADFAMPRADI&quot; &quot;ADCONTROL&quot; &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ CENTER                    : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP                        : num  87580 88413 88419 88418 88417 ...
##  $ IND                       : num  1 1 1 1 1 100 1 1 1 1 ...
##  $ REFCTR                    : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE                 : POSIXct, format: &quot;2016-09-07&quot; &quot;2020-03-06&quot; ...
##  $ EXAMINER                  : chr  &quot;ladams4&quot; &quot;sjt82&quot; &quot;mxp1257&quot; &quot;mxp1257&quot; ...
##  $ DATE_OF_BIRTH             : POSIXct, format: &quot;1925-08-21&quot; &quot;1928-02-14&quot; ...
##  $ AGE_AT_EXAM               : num  91 92 74 75 75 64 83 77 79 85 ...
##  $ REVIEW_DATE               : logi  NA NA NA NA NA NA ...
##  $ REVIEWER                  : logi  NA NA NA NA NA NA ...
##  $ MEMORY_COMPLAINTS         : num  NA 1 0 0 0 1 0 0 0 0 ...
##  $ DATE_OF_ONSET             : POSIXct, format: NA NA ...
##  $ DOA_UNK                   : chr  NA &quot;U&quot; NA NA ...
##  $ DESCRIBE                  : chr  &quot;hello&quot; &quot;No family history of dementia.&quot; &quot;Brother with PD.&quot; &quot;Denies psychological/psychiatric conditions.  Brother, mother, aunt (father&#39;s sister) and grandparents with AD &quot;| __truncated__ ...
##  $ MEM_COMPLAINTS            : chr  NA &quot;misplaces objects  Informant: Daughter and self 92 YO widow female who lives with daughter and  visits senior c&quot;| __truncated__ &quot;None. Lives alone. Can cook, clean and take care of self. Fully capable of self care and fully oriented. Drives&quot;| __truncated__ &quot;none. denies memoery issues. Lives with daughter. can cook, clean and do chores but daughter helps. Says she co&quot;| __truncated__ ...
##  $ CURRENT_MED               : chr  NA NA &quot;Hypertension and Thyroid issues&quot; &quot;Hypertension + neuropathy + metformin&quot; ...
##  $ PMH                       : chr  NA &quot;HTN&quot; &quot;Hypertension and Thyroid issues&quot; NA ...
##  $ MOOD_CHANGES              : chr  NA &quot;denies&quot; &quot;denies.&quot; NA ...
##  $ MEDICATIONS               : chr  NA &quot;lisinopril, clopidogrel&quot; NA &quot;not collected&quot; ...
##  $ HYPERTENSION_DX           : num  NA 1 NA NA NA 1 NA 0 1 1 ...
##  $ HYPERTENSION_TREATED      : num  NA 1 NA NA NA 1 NA 0 NA NA ...
##  $ DIABETES_DX               : num  NA 0 NA NA NA 1 NA 0 0 1 ...
##  $ DIABETES_TREATED          : num  NA NA NA NA NA 1 NA 0 NA NA ...
##  $ MYOCARDIAL_DX             : num  NA 0 NA NA NA 0 NA 0 0 1 ...
##  $ MYOCARDIAL_TREATED        : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ HEART_FAILURE_DX          : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ HEART_FAILURE_TREATED     : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ HEART_DISEASE_DX          : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ HEART_DISEASE_TREATED     : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ COPD_DX                   : num  NA 0 NA NA NA 0 NA 0 0 1 ...
##  $ COPD_TREATED              : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ THYROID_DX                : num  NA 0 NA NA NA 0 NA 1 0 0 ...
##  $ THYROID_TREATED           : num  NA NA NA NA NA 0 NA 1 NA NA ...
##  $ LIVER_DX                  : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ LIVER_TREATED             : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ RENAL_DX                  : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ RENAL_TREATED             : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ PEPTIC_DX                 : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ PEPTIC_TREATED            : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ PERIPHERAL_DX             : num  NA 0 NA NA NA 0 NA 1 0 0 ...
##  $ PERIPHERAL_TREATED        : num  NA NA NA NA NA 0 NA 1 NA NA ...
##  $ STROKE_DX                 : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ STROKE_TREATED            : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ TIA_DX                    : num  NA 0 NA NA NA 0 NA 0 0 1 ...
##  $ TIA_TREATED               : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ HEAD_INJURY_DX            : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ HEAD_INJURY_TREATED       : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ SEIZURE_DX                : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ SEIZURE_TREATED           : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ CANCER_DX                 : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ CANCER_TREATED            : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ ARTHRITIS_DX              : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ ARTHRITIS_TREATED         : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ SYPHILIS_DX               : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ SYPHILIS_TREATED          : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ ALCOHOL_DX                : num  NA 0 NA NA NA 0 NA 0 0 1 ...
##  $ ALCOHOL_TREATED           : num  NA NA NA NA NA 0 NA 0 0 9 ...
##  $ ILLICIT_DRUG_DX           : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ ILLICIT_DRUG_TREATED      : num  NA NA NA NA NA 0 NA 0 0 9 ...
##  $ SMOKING_DX                : num  NA 0 NA NA NA 0 NA 0 0 1 ...
##  $ SMOKING_TREATED           : num  NA NA NA NA NA 0 NA 0 0 9 ...
##  $ PD_DX                     : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ PD_TREATED                : num  NA NA NA NA NA 0 NA 0 0 9 ...
##  $ HUNTINGTON_DX             : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ HUNTINGTON_TREATED        : num  NA NA NA NA NA 0 NA 0 0 9 ...
##  $ MULTIPLE_SCLEROSIS_DX     : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ MULTIPLE_SCLEROSIS_TREATED: num  NA NA NA NA NA 0 NA 0 NA 9 ...
##  $ B12_DX                    : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ B12_TREATED               : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ HYDROCEPHALUS_DX          : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ HYDROCEPHALUS_TREATED     : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ TREMOR_DX                 : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ TREMOR_TREATED            : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ DOWN_SYNDROME_DX          : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ DOWN_SYNDROME_TREATED     : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ MED_CONDITIONS_DX         : num  NA 0 NA NA NA 0 NA 0 0 0 ...
##  $ MED_CONDITIONS_TREATED    : num  NA NA NA NA NA 0 NA 0 NA NA ...
##  $ OTH_MED_COND_SP           : chr  NA NA NA NA ...
##  $ STROKE_BRAIN              : num  NA 0 NA NA NA 0 NA 0 9 1 ...
##  $ DOCTOR                    : num  NA NA NA NA NA 0 NA 0 9 1 ...
##  $ STROKE_PAST               : num  NA NA NA NA NA 0 NA 0 9 1 ...
##  $ STROKE_24HRS              : num  NA NA NA NA NA 0 NA 0 9 0 ...
##  $ SYMPTOMS                  : num  NA NA NA NA NA 0 NA 0 9 0 ...
##  $ LOST_SPEECH               : num  NA 0 NA NA NA 0 NA 0 9 9 ...
##  $ LOST_UNDERSTAND           : num  NA 0 NA NA NA 0 NA 0 9 9 ...
##  $ LOSS_CONSCIOUS            : num  NA 0 NA NA NA 0 NA 0 9 9 ...
##  $ WEAKNESS                  : num  NA 0 NA NA NA 0 NA 0 9 9 ...
##  $ NUMBNESS                  : num  NA 0 NA NA NA 0 NA 0 9 9 ...
##  $ LOSS_VISION               : num  NA 0 NA NA NA 0 NA 0 9 9 ...
##  $ HALF_VISION               : num  NA 0 NA NA NA 0 NA 0 9 9 ...
##  $ PERIOD                    : num  NA 9 NA NA NA 9 NA 0 9 0 ...
##  $ AGE                       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DONT_KNOW                 : chr  NA NA NA NA ...
##  $ SEEK_HELP                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ TREATMENT                 : num  NA NA NA NA NA NA NA 0 NA NA ...
##  $ MEDS                      : num  NA NA NA NA NA NA NA 0 NA NA ...
##  $ PSYCHOTHERAPY             : num  NA NA NA NA NA NA NA 0 NA NA ...
##  $ OTHER                     : num  NA NA NA NA NA NA NA 0 NA NA ...
##  $ SPECIFY                   : chr  NA NA NA NA ...
##  $ UNKNOWN                   : num  NA NA NA NA NA NA NA 0 NA NA ...
##  $ TAKING_MEDS               : num  NA NA NA NA NA NA NA 1 NA NA ...
##  $ MEDICATION1               : chr  NA NA NA NA ...
##  $ STRENGTH1                 : chr  NA NA NA NA ...
##  $ SEEN1                     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN1_SPEC                : chr  NA NA NA NA ...
##  $ MEDICATION2               : chr  NA NA NA NA ...
##  $ STRENGTH2                 : chr  NA NA NA NA ...
##  $ SEEN2                     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN2_SPEC                : chr  NA NA NA NA ...
##  $ MEDICATION3               : chr  NA NA NA NA ...
##  $ STRENGTH3                 : chr  NA NA NA NA ...
##  $ SEEN3                     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN3_SPEC                : chr  NA NA NA NA ...
##  $ MEDICATION4               : chr  NA NA NA NA ...
##  $ STRENGTH4                 : chr  NA NA NA NA ...
##  $ SEEN4                     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN4_SPEC                : chr  NA NA NA NA ...
##  $ MEDICATION5               : chr  NA NA NA NA ...
##  $ STRENGTH5                 : chr  NA NA NA NA ...
##  $ SEEN5                     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN5_SPEC                : logi  NA NA NA NA NA NA ...
##  $ MEDICATION6               : chr  NA NA NA NA ...
##  $ STRENGTH6                 : chr  NA NA NA NA ...
##  $ SEEN6                     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN6_SPEC                : logi  NA NA NA NA NA NA ...
##  $ MEDICATION7               : chr  NA NA NA NA ...
##  $ STRENGTH7                 : chr  NA NA NA NA ...
##  $ SEEN7                     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN7_SPEC                : logi  NA NA NA NA NA NA ...
##  $ MEDICATION8               : chr  NA NA NA NA ...
##  $ STRENGTH8                 : chr  NA NA NA NA ...
##  $ SEEN8                     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN8_SPEC                : logi  NA NA NA NA NA NA ...
##  $ MEDICATION9               : chr  NA NA NA NA ...
##  $ STRENGTH9                 : chr  NA NA NA NA ...
##  $ SEEN9                     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN9_SPEC                : logi  NA NA NA NA NA NA ...
##  $ MEDICATION10              : chr  NA NA NA NA ...
##  $ STRENGTH10                : chr  NA NA NA NA ...
##  $ SEEN10                    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN10_SPEC               : logi  NA NA NA NA NA NA ...
##  $ MEDICATION11              : chr  NA NA NA NA ...
##  $ STRENGTH11                : chr  NA NA NA NA ...
##  $ SEEN11                    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN11_SPEC               : logi  NA NA NA NA NA NA ...
##  $ MEDICATION12              : chr  NA NA NA NA ...
##  $ STRENGTH12                : chr  NA NA NA NA ...
##  $ SEEN12                    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN12_SPEC               : logi  NA NA NA NA NA NA ...
##  $ MEDICATION13              : chr  NA NA NA NA ...
##  $ STRENGTH13                : chr  NA NA NA NA ...
##  $ SEEN13                    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN13_SPEC               : logi  NA NA NA NA NA NA ...
##  $ MEDICATION14              : chr  NA NA NA NA ...
##  $ STRENGTH14                : chr  NA NA NA NA ...
##  $ SEEN14                    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN14_SPEC               : logi  NA NA NA NA NA NA ...
##  $ MEDICATION15              : chr  NA NA NA NA ...
##  $ STRENGTH15                : logi  NA NA NA NA NA NA ...
##  $ SEEN15                    : logi  NA NA NA NA NA NA ...
##  $ SEEN15_SPEC               : logi  NA NA NA NA NA NA ...
##  $ MEDICATION16              : chr  NA NA NA NA ...
##  $ STRENGTH16                : logi  NA NA NA NA NA NA ...
##  $ SEEN16                    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN16_SPEC               : logi  NA NA NA NA NA NA ...
##  $ MEDICATION17              : chr  NA NA NA NA ...
##  $ STRENGTH17                : logi  NA NA NA NA NA NA ...
##  $ SEEN17                    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SEEN17_SPEC               : logi  NA NA NA NA NA NA ...
##  $ MEDICATION18              : logi  NA NA NA NA NA NA ...
##  $ STRENGTH18                : logi  NA NA NA NA NA NA ...
##  $ SEEN18                    : logi  NA NA NA NA NA NA ...
##  $ SEEN18_SPEC               : logi  NA NA NA NA NA NA ...
##  $ MEDICATION19              : logi  NA NA NA NA NA NA ...
##  $ STRENGTH19                : logi  NA NA NA NA NA NA ...
##  $ SEEN19                    : logi  NA NA NA NA NA NA ...
##  $ SEEN19_SPEC               : logi  NA NA NA NA NA NA ...
##  $ MEDICATION20              : logi  NA NA NA NA NA NA ...
##  $ STRENGTH20                : logi  NA NA NA NA NA NA ...
##  $ SEEN20                    : logi  NA NA NA NA NA NA ...
##  $ SEEN20_SPEC               : logi  NA NA NA NA NA NA ...
##  $ NOTES                     : chr  NA NA NA NA ...
##  $ WARFARIN                  : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ASPIRIN                   : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ANTIPLATELETS             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DIURETICS                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ANTICONVULSANTS           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ INSULIN                   : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ HYPOGLYCEMICS             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SULFONYLUREA              : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ METFORMIN                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ GLITAZONES                : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DIGITALIS                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ NITRATES                  : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ CALCIUM_CHANNEL           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ BETA_2_AGAONIST           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ BETA_BLOCKERS             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ACE                       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ANTI_ARRHYTHMICS          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ANTI_HYPERLIPIDEMICS      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ STATIN_DRUG               : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ FIBRATE_DRUG              : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ THYROID                   : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ANTICHOLINERGICS          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ LEVODOPA                  : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DOPAMINE                  : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ANTIDEPRESSANTS           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ANTIPSYCHOTICS            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ANXIOLYTICS               : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ CHOLINESTERASE            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ RIVASTIGMINE              : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ TACRINE                   : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DONEPEZIL                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ GALANTAMINE               : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ NMDA                      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MEMANTINE                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ALPHA_BLOCKERS            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ HYPNOTICS                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ H1_BLOCKERS               : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ H2_BLOCKERS               : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ NSAID                     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ COX2                      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ NARCOTICS                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ HYDERGINE                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DEPRENYL                  : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ESTROGEN_SUPP             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PRESCRIPTION              : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ OTC                       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ STEROIDS                  : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ OTHER_MEDS                : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ SPEC_MEDS                 : chr  NA NA NA NA ...
##  $ MULTIVITAMINS             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ VITAMIN_C                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ VITAMIN_E                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ VITAMINE_B12              : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ COENZYME_Q                : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DHA                       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ LECITHIN                  : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ GINKGO                    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ FOLIC_ACID                : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ VITAMIN_B6                : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ VITAMIN_D                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ OMEGA3                    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MEDCOND_COMENTS           : logi  NA NA NA NA NA NA ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-1" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;AAAD_MEDCON&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-1" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## 33 vars

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 33 × 2
##    VarNames    `Data Type`  
##    &lt;chr&gt;       &lt;chr&gt;        
##  1 REFCTR      VARCHAR2(6)  
##  2 REVIEW_DATE date         
##  3 REVIEWER    VARCHAR      
##  4 SEEN5_SPEC  VARCHAR2(100)
##  5 SEEN6_SPEC  VARCHAR2(100)
##  6 SEEN7_SPEC  VARCHAR2(100)
##  7 SEEN8_SPEC  VARCHAR2(100)
##  8 SEEN9_SPEC  VARCHAR2(100)
##  9 SEEN10_SPEC VARCHAR2(100)
## 10 SEEN11_SPEC VARCHAR2(100)
## # ℹ 23 more rows</code></pre>
<pre class="r"><code>## select the vars to be converted to numeric
convert2num &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;NUMBER&quot;, dfDD$`Data Type`)] ## &quot;SEEN15&quot; &quot;SEEN18&quot; &quot;SEEN19&quot; &quot;SEEN20&quot;

## select the vars to be converted to date
convert2date &lt;-  dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;date&quot;,dfDD$`Data Type`,ignore.case = T)] ## REVIEW_DATE

## the rest should be converted to character
convert2chr &lt;- setdiff(logicols,c(convert2num,convert2date)) ## 28 vars

## convert
df[convert2num] &lt;- lapply(df[convert2num], as.numeric)
df[convert2date] &lt;- lapply(df[convert2date], as.Date)
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-1" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot; &quot;DATE_OF_ONSET&quot;

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## &quot;REVIEW_DATE, ignore it, since it has been converted in previous step</code></pre>
<pre><code>## [1] &quot;REVIEW_DATE&quot;</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH DATE_OF_ONSET
## 1 2016-09-07    1925-08-21          &lt;NA&gt;
## 2 2020-03-06    1928-02-14          &lt;NA&gt;
## 3 2020-03-06    1945-09-01          &lt;NA&gt;
## 4 2020-03-06    1944-03-22          &lt;NA&gt;
## 5 2020-03-06    1944-10-17          &lt;NA&gt;
## 6 2020-03-05    1955-06-26    2016-09-09</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-1" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)]
## 81 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## DOA_UNK, ignore, I have updated DD to &quot;char&quot;
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<pre><code>## All values are within valid ranges.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-88ab3cd6b07a51a35f96" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-88ab3cd6b07a51a35f96">{"x":null,"evals":[],"jsHooks":[]}</script>
<p><br></p>
</div>
<div id="handling-numeric-variables-1" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 31 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA                           &quot;1 thru 99999;&quot;             
## [3] &quot;1 thru 9999;&quot;               &quot;0;\r\n1;&quot;                  
## [5] &quot;0;\r\n1;\r\n9;\r\n-1;&quot;      &quot;0;\r\n1;\r\n7;\r\n8;\r\n9;&quot;
## [7] &quot;0;\r\n1;\r\n9;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-13c9ddcd83ff0a82e0c9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-13c9ddcd83ff0a82e0c9">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104406, 104405, 104422, 104428, 104435, 104437, 104411, 104418, 104442, 104445, 104427, 104460, 104415, 104410, 104466, 104438, 104419, 104409, 104446, 104464, 104408, 104431, 104407, 104432, 104439, 104420, 104423, 104424, 104530, 104501, 104412, 104426, 104403, 104429, 104433, 104440, 104443, 104444, 104425, 104413, 104441, 104430, 104421, 104404, 104402, 104436, 104401"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP and IND</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-1" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_AAAD_MEDCON &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="aaad_socio_demo" class="section level2">
<h2>AAAD_SOCIO_DEMO</h2>
<pre class="r"><code>df &lt;- AAAD_SOCIO_DEMO

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    402 obs. of  161 variables:
##  $ SYSXM        : num  7895153 7875263 7879973 7879993 7880213 ...
##  $ SYSIND       : num  11218613 11036843 11041143 11041043 11005233 ...
##  $ SYSGP        : num  7928123 7893863 7894373 7894373 7888553 ...
##  $ SYSGPSTUDY   : num  1366233 1309183 1309693 1309693 1303893 ...
##  $ SYSINDGP     : num  7981883 7792583 7797003 7796903 7760033 ...
##  $ CGI_ORDER    : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER    : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY       : chr  &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ DB_OWNER     : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY        : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY     : chr  &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ CENTER       : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP           : num  87998 87598 87502 87502 87501 ...
##  $ IND          : num  1 1 102 100 1 1 1 1 1 1 ...
##  $ REFCTR       : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE    : POSIXct, format: &quot;2021-02-01&quot; &quot;2020-07-14&quot; ...
##  $ EXAMINER     : chr  &quot;sjt82&quot; &quot;v.rodriguez4&quot; &quot;prm72&quot; &quot;prm72&quot; ...
##  $ DATE_OF_BIRTH: POSIXct, format: &quot;1943-09-22&quot; &quot;1946-10-04&quot; ...
##  $ AGE_AT_EXAM  : num  77 73 69 71 81 84 85 77 83 85 ...
##  $ REVIEW_DATE  : logi  NA NA NA NA NA NA ...
##  $ REVIEWER     : logi  NA NA NA NA NA NA ...
##  $ SDF1         : num  0 NA NA NA NA NA NA NA NA NA ...
##  $ SDF2         : num  1 NA NA NA NA NA NA NA NA NA ...
##  $ SDF2A        : chr  &quot;WH&quot; NA NA NA ...
##  $ SDF3         : num  0 NA NA NA NA NA NA NA NA NA ...
##  $ SDF3A        : chr  &quot;SPANISH&quot; NA NA NA ...
##  $ SDF4         : chr  &quot;W&quot; NA NA NA ...
##  $ SDF4A        : chr  NA NA NA NA ...
##  $ SDF5         : chr  &quot;A&quot; NA NA NA ...
##  $ SDF5A        : chr  NA NA NA NA ...
##  $ SDF6         : chr  &quot;SF&quot; NA NA NA ...
##  $ SDF6A        : chr  NA NA NA NA ...
##  $ SDF7         : chr  NA NA NA NA ...
##  $ SDF8A        : chr  &quot;PT&quot; NA NA NA ...
##  $ SDF8B        : chr  NA NA NA NA ...
##  $ SDF8C        : chr  NA NA NA NA ...
##  $ SDF9         : chr  NA NA NA NA ...
##  $ SDF10        : chr  NA NA NA NA ...
##  $ SDF11        : chr  NA NA NA NA ...
##  $ SDF12        : logi  NA NA NA NA NA NA ...
##  $ SDF13        : logi  NA NA NA NA NA NA ...
##  $ SDF14        : logi  NA NA NA NA NA NA ...
##  $ SDF15        : logi  NA NA NA NA NA NA ...
##  $ SDF16        : logi  NA NA NA NA NA NA ...
##  $ SDF17        : logi  NA NA NA NA NA NA ...
##  $ SDF17A       : logi  NA NA NA NA NA NA ...
##  $ SDF18        : logi  NA NA NA NA NA NA ...
##  $ SDF19        : logi  NA NA NA NA NA NA ...
##  $ SDF20        : chr  &quot;TEACHER ASSISTANT&quot; &quot;UNKNOWN&quot; &quot;Computer service tech&quot; &quot;Engineer&quot; ...
##  $ SDF21        : chr  NA NA NA NA ...
##  $ SDF22        : logi  NA NA NA NA NA NA ...
##  $ SDF22A       : chr  NA NA NA NA ...
##  $ SDF23        : logi  NA NA NA NA NA NA ...
##  $ SDF24        : logi  NA NA NA NA NA NA ...
##  $ SDF25        : logi  NA NA NA NA NA NA ...
##  $ SDF26        : logi  NA NA NA NA NA NA ...
##  $ SDF27A       : logi  NA NA NA NA NA NA ...
##  $ SDF27B       : logi  NA NA NA NA NA NA ...
##  $ SDF27C       : logi  NA NA NA NA NA NA ...
##  $ SDF27D       : logi  NA NA NA NA NA NA ...
##  $ SDF27E       : logi  NA NA NA NA NA NA ...
##  $ SDF27F       : logi  NA NA NA NA NA NA ...
##  $ SDF27G       : logi  NA NA NA NA NA NA ...
##  $ SDF27H       : logi  NA NA NA NA NA NA ...
##  $ SDF28        : logi  NA NA NA NA NA NA ...
##  $ SDF29        : logi  NA NA NA NA NA NA ...
##  $ SDF30A       : logi  NA NA NA NA NA NA ...
##  $ SDF30B       : logi  NA NA NA NA NA NA ...
##  $ SDF30C       : logi  NA NA NA NA NA NA ...
##  $ SDF30D       : logi  NA NA NA NA NA NA ...
##  $ SDF30E       : logi  NA NA NA NA NA NA ...
##  $ SDF30F       : logi  NA NA NA NA NA NA ...
##  $ SDF30G       : logi  NA NA NA NA NA NA ...
##  $ SDF31        : logi  NA NA NA NA NA NA ...
##  $ SDF31A       : logi  NA NA NA NA NA NA ...
##  $ SDF32        : logi  NA NA NA NA NA NA ...
##  $ SDF33        : logi  NA NA NA NA NA NA ...
##  $ SDF33A       : logi  NA NA NA NA NA NA ...
##  $ SDF34        : logi  NA NA NA NA NA NA ...
##  $ SDF35        : logi  NA NA NA NA NA NA ...
##  $ SDF36        : logi  NA NA NA NA NA NA ...
##  $ SDF37        : logi  NA NA NA NA NA NA ...
##  $ SDF38        : logi  NA NA NA NA NA NA ...
##  $ SDF39        : logi  NA NA NA NA NA NA ...
##  $ SDF40        : logi  NA NA NA NA NA NA ...
##  $ SDF41        : logi  NA NA NA NA NA NA ...
##  $ SDF42        : logi  NA NA NA NA NA NA ...
##  $ SDF42A       : logi  NA NA NA NA NA NA ...
##  $ SDF42B       : logi  NA NA NA NA NA NA ...
##  $ SDF43A       : logi  NA NA NA NA NA NA ...
##  $ SDF43A1      : logi  NA NA NA NA NA NA ...
##  $ SDF43B       : logi  NA NA NA NA NA NA ...
##  $ SDF43B1      : logi  NA NA NA NA NA NA ...
##  $ SDF43C       : logi  NA NA NA NA NA NA ...
##  $ SDF43C1      : logi  NA NA NA NA NA NA ...
##  $ SDF44        : logi  NA NA NA NA NA NA ...
##  $ SDF44A       : logi  NA NA NA NA NA NA ...
##  $ SDF45A       : logi  NA NA NA NA NA NA ...
##  $ SDF45A1      : logi  NA NA NA NA NA NA ...
##  $ SDF45B       : logi  NA NA NA NA NA NA ...
##  $ SDF45B1      : logi  NA NA NA NA NA NA ...
##  $ SDF46        : logi  NA NA NA NA NA NA ...
##  $ SDF47        : logi  NA NA NA NA NA NA ...
##  $ SDF48        : logi  NA NA NA NA NA NA ...
##  $ SDF49A       : logi  NA NA NA NA NA NA ...
##  $ SDF49B       : logi  NA NA NA NA NA NA ...
##  $ SDF49C       : logi  NA NA NA NA NA NA ...
##  $ SDF49D       : logi  NA NA NA NA NA NA ...
##  $ SDF50A       : logi  NA NA NA NA NA NA ...
##  $ SDF50B       : logi  NA NA NA NA NA NA ...
##  $ SDF50C       : logi  NA NA NA NA NA NA ...
##  $ SDF50D       : logi  NA NA NA NA NA NA ...
##  $ SDF51        : logi  NA NA NA NA NA NA ...
##  $ SDF51A       : logi  NA NA NA NA NA NA ...
##  $ SDF52A       : logi  NA NA NA NA NA NA ...
##  $ SDF52B       : logi  NA NA NA NA NA NA ...
##  $ SDF53A       : logi  NA NA NA NA NA NA ...
##  $ SDF53A1      : logi  NA NA NA NA NA NA ...
##  $ SDF53B       : logi  NA NA NA NA NA NA ...
##  $ SDF53C       : logi  NA NA NA NA NA NA ...
##  $ SDF53C1      : logi  NA NA NA NA NA NA ...
##  $ SDF54        : logi  NA NA NA NA NA NA ...
##  $ SDF55        : logi  NA NA NA NA NA NA ...
##  $ SDF56        : logi  NA NA NA NA NA NA ...
##  $ SDF57A       : logi  NA NA NA NA NA NA ...
##  $ SDF57B       : logi  NA NA NA NA NA NA ...
##  $ SDF57C       : logi  NA NA NA NA NA NA ...
##  $ SDF57D       : logi  NA NA NA NA NA NA ...
##  $ SDF58A       : logi  NA NA NA NA NA NA ...
##  $ SDF58B       : logi  NA NA NA NA NA NA ...
##  $ SDF58C       : logi  NA NA NA NA NA NA ...
##  $ SDF58D       : logi  NA NA NA NA NA NA ...
##  $ SDF59        : logi  NA NA NA NA NA NA ...
##  $ SDF59A       : logi  NA NA NA NA NA NA ...
##  $ SDF60A       : logi  NA NA NA NA NA NA ...
##  $ SDF60B       : logi  NA NA NA NA NA NA ...
##  $ SDF60C       : logi  NA NA NA NA NA NA ...
##  $ SDF60D       : logi  NA NA NA NA NA NA ...
##  $ SDF60E       : logi  NA NA NA NA NA NA ...
##  $ SDF60F       : logi  NA NA NA NA NA NA ...
##  $ SDF60FS      : logi  NA NA NA NA NA NA ...
##  $ SDF60G       : logi  NA NA NA NA NA NA ...
##  $ SDF60GS      : logi  NA NA NA NA NA NA ...
##  $ SDF61A       : logi  NA NA NA NA NA NA ...
##  $ SDF61A1      : logi  NA NA NA NA NA NA ...
##  $ SDF61B       : logi  NA NA NA NA NA NA ...
##  $ SDF61C       : logi  NA NA NA NA NA NA ...
##  $ SDF61C1      : logi  NA NA NA NA NA NA ...
##  $ SDF62A       : logi  NA NA NA NA NA NA ...
##  $ SDF62B       : logi  NA NA NA NA NA NA ...
##  $ SDF62C       : logi  NA NA NA NA NA NA ...
##  $ SDF62D       : logi  NA NA NA NA NA NA ...
##  $ SDF63A       : logi  NA NA NA NA NA NA ...
##  $ SDF63B       : logi  NA NA NA NA NA NA ...
##  $ SDF63C       : logi  NA NA NA NA NA NA ...
##  $ SDF63D       : logi  NA NA NA NA NA NA ...
##  $ SDF64        : logi  NA NA NA NA NA NA ...
##  $ SDF65        : logi  NA NA NA NA NA NA ...
##  $ SDF65A       : logi  NA NA NA NA NA NA ...
##  $ SDF66        : logi  NA NA NA NA NA NA ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-2" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;AAAD_SOCIO_DEMO&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-2" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## 121

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 121 × 2
##    VarNames    `Data Type`  
##    &lt;chr&gt;       &lt;chr&gt;        
##  1 REFCTR      VARCHAR2(6)  
##  2 REVIEW_DATE date         
##  3 REVIEWER    VARCHAR      
##  4 SDF12       VARCHAR2(200)
##  5 SDF13       NUMBER(3)    
##  6 SDF14       CHAR(2)      
##  7 SDF15       CHAR(2)      
##  8 SDF16       CHAR(2)      
##  9 SDF17       NUMBER(2)    
## 10 SDF17A      CHAR(2)      
## # ℹ 111 more rows</code></pre>
<pre class="r"><code>## select the vars to be converted to numeric
convert2num &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;NUMBER&quot;, dfDD$`Data Type`)] ## 55 vars

## select the vars to be converted to date
convert2date &lt;-  dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;date&quot;,dfDD$`Data Type`,ignore.case = T)]
## [1] &quot;REVIEW_DATE&quot;

## the rest should be converted to character
convert2chr &lt;- setdiff(logicols,c(convert2num,convert2date)) ## 65 vars

## convert
df[convert2num] &lt;- lapply(df[convert2num], as.numeric)
df[convert2date] &lt;- lapply(df[convert2date], as.Date)
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-2" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot;

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## REVIEW_DATE, can ignore, since it has been converted in last step</code></pre>
<pre><code>## [1] &quot;REVIEW_DATE&quot;</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH
## 1 2021-02-01    1943-09-22
## 2 2020-07-14    1946-10-04
## 3 2020-09-16    1950-10-02
## 4 2020-09-16    1949-04-30
## 5 2019-05-22    1937-10-24
## 6 2020-09-17    1935-10-25</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-2" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 89 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-2c9494f92637031e2d7a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2c9494f92637031e2d7a">{"x":{"filter":"none","vertical":false,"data":[["SDF8A","SDF8B"],["SDF8A","SDF8B"],["FT  PT","FT  PD, R  O, U  R, T  R, R  PD"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>unique(df[[&quot;SDF8A&quot;]]) ## DD: 8. Are you working now? Circle all that apply</code></pre>
<pre><code>## [1] &quot;PT&quot;     NA       &quot;FT&quot;     &quot;V&quot;      &quot;FT  PT&quot;</code></pre>
<pre class="r"><code>unique(df[[&quot;SDF8B&quot;]]) ## DD: If participant says NO, ask Why not? If any of the following SKIP TO #20</code></pre>
<pre><code>##  [1] NA       &quot;O&quot;      &quot;FT&quot;     &quot;R&quot;      &quot;PD&quot;     &quot;FT  PD&quot; &quot;R  O&quot;   &quot;U  R&quot;  
##  [9] &quot;S&quot;      &quot;U&quot;      &quot;IS&quot;     &quot;T&quot;      &quot;T  R&quot;   &quot;R  PD&quot;</code></pre>
<pre class="r"><code>## NOTE: these two variables are good, as they being marked &quot;Multiple&quot; in the [Single, Multiple or Calculated Values] column of DD</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-2" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 69 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>##  [1] NA                            &quot;1 thru 99999;&quot;              
##  [3] &quot;1 thru 9999;&quot;                &quot;1;\r\n0;&quot;                   
##  [5] &quot;1 thru 145;&quot;                 &quot;1 thru 31;&quot;                 
##  [7] &quot;-2;&quot;                         &quot;0 thru 8;&quot;                  
##  [9] &quot;1;\r\n2;\r\n3;\r\n4;\r\n-2;&quot; &quot;0 thru 100;&quot;                
## [11] &quot;0 thru 5;&quot;                   &quot;0;\r\n1;\r\n-2;&quot;            
## [13] &quot;1;\r\n0;\r\n-2;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-a378f20690f1b631a3a2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a378f20690f1b631a3a2">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104406, 104422, 104435, 104437, 104411, 104418, 104445, 104427, 104410, 104420, 104438, 104415, 104419, 104409, 104421, 104428, 104405, 104446, 104431, 104408, 104407, 104432, 104439, 104423, 104424, 104442, 104412, 104426"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-2" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_AAAD_SOCIO_DEMO &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="aaad_trails" class="section level2">
<h2>AAAD_TRAILS</h2>
<pre class="r"><code>df &lt;- AAAD_TRAILS

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    439 obs. of  34 variables:
##  $ SYSXM        : num  7670123 7650923 7651273 7659813 7660113 ...
##  $ SYSIND       : num  11221133 11218963 11219583 11036793 11221813 ...
##  $ SYSGP        : num  7929223 7928203 7928153 7893833 7929683 ...
##  $ SYSGPSTUDY   : num  1367333 1366313 1366263 1309153 1367793 ...
##  $ SYSINDGP     : num  7984403 7982233 7982853 7792533 7985083 ...
##  $ CGI_ORDER    : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER    : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY       : chr  &quot;ADCRLPRADI&quot; &quot;ADCONTROL&quot; &quot;ADFAMPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ DB_OWNER     : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY        : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY     : chr  &quot;ADCRLPRADI&quot; &quot;ADCONTROL&quot; &quot;ADFAMPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ CENTER       : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP           : num  88063 88095 88002 87595 88059 ...
##  $ IND          : num  1 1 100 9000 1 1 1 1 100 1 ...
##  $ REFCTR       : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE    : POSIXct, format: &quot;2019-03-07&quot; &quot;2019-03-08&quot; ...
##  $ EXAMINER     : chr  &quot;bxf258&quot; &quot;sjt82&quot; &quot;v.rodriguez4&quot; &quot;v.rodriguez4&quot; ...
##  $ DATE_OF_BIRTH: POSIXct, format: &quot;1928-01-11&quot; &quot;1941-05-02&quot; ...
##  $ AGE_AT_EXAM  : num  91 77 68 62 84 84 77 72 71 65 ...
##  $ REVIEW_DATE  : logi  NA NA NA NA NA NA ...
##  $ REVIEWER     : logi  NA NA NA NA NA NA ...
##  $ TIME_A       : num  NA 70 56 93 71 71 NA 30 275 60 ...
##  $ TIME_AMISS   : num  -1 NA NA NA NA NA NA NA NA NA ...
##  $ ERR_A        : num  0 0 2 1 0 0 1 0 1 0 ...
##  $ ERR_AMISS    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ COR_A        : num  24 24 22 23 24 24 23 24 24 24 ...
##  $ COR_AMISS    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ TIME_B       : num  NA 225 124 109 240 240 NA 71 NA 90 ...
##  $ TIME_BMISS   : num  -1 NA NA NA NA NA NA NA -2 NA ...
##  $ ERR_B        : num  NA 4 0 0 0 0 NA 0 NA 0 ...
##  $ ERR_BMISS    : num  -1 NA NA NA NA NA NA NA -2 NA ...
##  $ COR_B        : num  NA 20 24 24 24 24 NA 24 NA 24 ...
##  $ COR_BMISS    : num  -1 NA NA NA NA NA NA NA -2 NA ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-3" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;AAAD_TRAILS&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-3" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## 3

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 3 × 2
##   VarNames    `Data Type`
##   &lt;chr&gt;       &lt;chr&gt;      
## 1 REFCTR      VARCHAR2(6)
## 2 REVIEW_DATE date       
## 3 REVIEWER    VARCHAR</code></pre>
<pre class="r"><code>## select the vars to be converted to date
convert2date &lt;-  dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;date&quot;,dfDD$`Data Type`,ignore.case = T)]
## [1] &quot;REVIEW_DATE&quot;

## the rest should be converted to character
convert2chr &lt;- setdiff(logicols,c(convert2num,convert2date)) ## 2 vars

## convert
df[convert2date] &lt;- lapply(df[convert2date], as.Date)
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-3" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot;

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## REVIEW_DATE, can ignore, since it has been converted in previous step</code></pre>
<pre><code>## [1] &quot;REVIEW_DATE&quot;</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH
## 1 2019-03-07    1928-01-11
## 2 2019-03-08    1941-05-02
## 3 2019-03-04    1950-03-25
## 4 2019-03-08    1956-10-19
## 5 2019-03-07    1934-11-07
## 6 2019-03-07    1934-12-03</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-3" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 8 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## [1] &quot;TIME_AMISS&quot; &quot;ERR_AMISS&quot;  &quot;COR_AMISS&quot;  &quot;TIME_BMISS&quot; &quot;ERR_BMISS&quot;  &quot;COR_BMISS&quot;

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## as those variables in mismatchChrs_2 all have numeric values as valid responses, I think they should be categorized as numeric variables.
## so I decided to update the DD for those variables

## reload the DD
dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;AAAD_TRAILS&quot;)
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]
mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<pre><code>## All values are within valid ranges.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5d5f427390de685805f8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5d5f427390de685805f8">{"x":null,"evals":[],"jsHooks":[]}</script>
<p><br></p>
</div>
<div id="handling-numeric-variables-3" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 23 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA                  &quot;1 thru 99999;&quot;     &quot;1 thru 9999;&quot;     
## [4] &quot;0 thru 150;&quot;       &quot;-1;\r\n-2;\r\n-3;&quot; &quot;0 thru 40;&quot;       
## [7] &quot;0 thru 24;&quot;        &quot;0 thru 300;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-c27dd1c23fd745f0714e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c27dd1c23fd745f0714e">{"x":{"filter":"none","vertical":false,"data":[["GP","TIME_A","COR_A","TIME_B","COR_B"],["GP","TIME_A","COR_A","TIME_B","COR_B"],["104406, 104422, 104435, 104437, 104411, 104418, 104407, 104445, 104427, 104415, 104410, 104428, 104438, 104419, 104409, 104446, 104408, 104431, 104432, 104439, 104420, 104423, 104424, 104442, 104412, 104426, 104405, 104403, 104425, 104413, 104443, 104436, 104430, 104421, 104433, 104402, 104416","275, 180, 187, 190, 195, 205, 170, 300, 160, 188, 159, 169, 165","25","400, 302, 341, 328, 383, 326, 590, 316","25"],["1 - 99999","0 - 150","0 - 24","0 - 300","0 - 24"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP and IND
## need to contact Mike about other variables: TIME_A, TIME_B, COR_B</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-3" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_AAAD_TRAILS &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_b9_judge_rc" class="section level2">
<h2>ALZ_B9_JUDGE_RC</h2>
<pre class="r"><code>df &lt;- ALZ_B9_JUDGE_RC

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    483 obs. of  82 variables:
##  $ SYSXM                  : num  8276003 8276013 8258753 8259063 8277553 ...
##  $ SYSIND                 : num  11620433 11160523 11034403 11369813 11620763 ...
##  $ SYSGP                  : num  8005513 7923793 7888823 7952013 8005723 ...
##  $ SYSGPSTUDY             : num  1452223 1361903 1304163 1397123 1452433 ...
##  $ SYSINDGP               : num  8389503 7923633 7790023 8139083 8389833 ...
##  $ CGI_ORDER              : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER              : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER           : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY                 : chr  &quot;ADCONTROL&quot; &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ DB_OWNER               : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY                  : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY               : chr  &quot;ADCONTROL&quot; &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ CENTER                 : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP                     : num  104507 87883 87556 88301 104457 ...
##  $ IND                    : num  1 1 9001 1 1 ...
##  $ REFCTR                 : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE              : POSIXct, format: &quot;2023-08-09&quot; &quot;2024-02-14&quot; ...
##  $ EXAMINER               : chr  &quot;jjs2031&quot; &quot;gsv32&quot; &quot;jjs2031&quot; &quot;jjs2031&quot; ...
##  $ DATE_OF_BIRTH          : POSIXct, format: &quot;1944-06-21&quot; &quot;1939-03-20&quot; ...
##  $ AGE_AT_EXAM            : num  79 84 68 76 76 81 86 73 86 66 ...
##  $ REVIEW_DATE            : logi  NA NA NA NA NA NA ...
##  $ REVIEWER               : logi  NA NA NA NA NA NA ...
##  $ MEMORY_DECLINE         : num  0 1 0 0 1 0 1 0 0 1 ...
##  $ COP_RPT_MEMDECLINE     : num  8 1 0 0 8 8 0 0 0 1 ...
##  $ MEANINGFUL_IMP         : num  0 1 0 0 1 0 1 0 0 1 ...
##  $ IMP_MEMORY             : num  NA 1 NA NA 1 NA 1 NA NA 1 ...
##  $ IMP_ORIENTATION        : num  NA 0 NA NA 1 NA 0 NA NA 1 ...
##  $ IMP_EXEC_FUNC          : num  NA 0 NA NA 1 NA 0 NA NA 1 ...
##  $ IMP_LANGUAGE           : num  NA 0 NA NA 0 NA 0 NA NA 0 ...
##  $ IMP_VISUOSPATIAL       : num  NA 0 NA NA 0 NA 0 NA NA 0 ...
##  $ IMP_ATTENTION          : num  NA 0 NA NA 0 NA 0 NA NA 1 ...
##  $ IMP_FLUCTUATING_COG    : num  NA 0 NA NA 0 NA 0 NA NA 0 ...
##  $ IMP_FLUCTUATING_AGE    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ IMP_OTHER              : num  NA 0 NA NA 0 NA 0 NA NA 0 ...
##  $ IMP_OTH_SPECIFY        : chr  NA NA NA NA ...
##  $ IMP_PREDOMINANT_SYMP   : num  NA 1 NA NA 1 NA 1 NA NA 1 ...
##  $ IMP_PRED_SYMP_OTH      : chr  NA NA NA NA ...
##  $ IMP_MODE_ONSET         : num  NA 1 NA NA 1 NA 1 NA NA 1 ...
##  $ MODE_ONSET6A           : logi  NA NA NA NA NA NA ...
##  $ BEGIN_AGE              : num  NA 83 NA NA 76 NA 86 NA NA 63 ...
##  $ BEHAV_SYMPTOMS         : num  0 1 0 0 0 0 0 0 0 1 ...
##  $ BS_APATHY              : num  NA 0 NA NA NA NA NA NA NA 0 ...
##  $ BS_DEPRESSED           : num  NA 1 NA NA NA NA NA NA NA 1 ...
##  $ BS_VISUAL_HAL          : num  NA 1 NA NA NA NA NA NA NA 0 ...
##  $ HAL_WELL_INFORMED      : num  NA 1 NA NA NA NA NA NA NA NA ...
##  $ HAL_BEGIN_AGE          : num  NA 83 NA NA NA NA NA NA NA NA ...
##  $ AUDITORY_HAL           : num  NA 0 NA NA NA NA NA NA NA 0 ...
##  $ ABN_BELIEFS            : num  NA 0 NA NA NA NA NA NA NA 0 ...
##  $ BS_DISINIBITION        : num  NA 0 NA NA NA NA NA NA NA 0 ...
##  $ BS_IRRITABILITY        : num  NA 0 NA NA NA NA NA NA NA 0 ...
##  $ BS_AGITATION           : num  NA 0 NA NA NA NA NA NA NA 0 ...
##  $ BS_PERSONAL_CHG        : num  NA 0 NA NA NA NA NA NA NA 0 ...
##  $ BS_REM                 : num  NA 0 NA NA NA NA NA NA NA 0 ...
##  $ REM_BEGIN_AGE          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ BS_ANXIETY             : num  NA 1 NA NA NA NA NA NA NA 0 ...
##  $ BS_OTHER               : num  NA 0 NA NA NA NA NA NA NA 0 ...
##  $ BS_OTHER_SPEC          : chr  NA NA NA NA ...
##  $ BS_PREDOMINANT_SYMP    : num  NA 2 NA NA NA NA NA NA NA 2 ...
##  $ BS_PRED_SYMP_OTH       : chr  NA NA NA NA ...
##  $ BS_MODE_ONSET          : num  NA 1 NA NA NA NA NA NA NA 2 ...
##  $ BS_MODE_ONSET_OTH      : chr  NA NA NA NA ...
##  $ BS_BEGIN_AGE           : num  NA 74 NA NA NA NA NA NA NA 63 ...
##  $ MOTOR_SYPTOMS          : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ MS_GAIT1               : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MS_FALLS1              : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MS_TREMOR1             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MS_SLOWNESS1           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MS_PRED_SYMPTOM        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MS_MODE_ONSET          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MS_MODE_ONSET_OTH      : chr  NA NA NA NA ...
##  $ MS_PARKINSONISM        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PARK_BEGIN_AGE         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MS_ALS                 : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MS_ALS_BEGIN_AGE       : logi  NA NA NA NA NA NA ...
##  $ MS_BEGIN_AGE           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ OVERALL_COURSE_DEC     : num  8 1 8 8 1 8 8 8 8 1 ...
##  $ PRED_DOMAIN            : num  8 2 8 8 1 8 8 8 8 1 ...
##  $ LBD_CANDIDATE          : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ FLD_CANDIDATE          : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ NOTES_B9JUDGE          : chr  NA NA NA NA ...
##  $ TOTALSCORE_B9_Q9       : num  0 3 0 0 0 0 0 0 0 1 ...
##  $ TOTALSCORE_B9_Q9_STATUS: chr  NA NA NA NA ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-4" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>## I dont see the DD for this dataset</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_clinicalsum" class="section level2">
<h2>ALZ_CLINICALSUM</h2>
<pre class="r"><code>df &lt;- ALZ_CLINICALSUM

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    1484 obs. of  39 variables:
##  $ SYSXM            : num  8063903 8066823 8067393 8065353 8058883 ...
##  $ SYSIND           : num  11493593 11493813 11493613 11493363 11493633 ...
##  $ SYSGP            : num  7946353 7946353 7946353 7946353 7946353 ...
##  $ SYSGPSTUDY       : num  1387463 1387463 1387463 1387463 1387463 ...
##  $ SYSINDGP         : num  8262663 8262883 8262683 8262433 8262703 ...
##  $ CGI_ORDER        : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER        : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER     : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY           : chr  &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ DB_OWNER         : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY            : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY         : chr  &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ CENTER           : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP               : num  87545 87545 87545 87545 87545 ...
##  $ IND              : num  9026 1024 144 124 148 ...
##  $ REFCTR           : logi  NA NA NA NA NA NA ...
##  $ DATE_OF_BIRTH    : POSIXct, format: &quot;1973-01-14&quot; &quot;1941-04-03&quot; ...
##  $ LAST_CONTACT_DATE: logi  NA NA NA NA NA NA ...
##  $ LAST_CONTACT_AGE : logi  NA NA NA NA NA NA ...
##  $ AGE_OF_DEATH     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ AGE_OF_EXAM      : num  49 80 67 77 64 75 78 61 71 82 ...
##  $ IMPRESSION       : chr  &quot;Affected By Exam&quot; &quot;Affected By Exam&quot; &quot;Affected By Exam&quot; &quot;Affected By Exam&quot; ...
##  $ AD_CATEGORY      : chr  &quot;No Data&quot; &quot;No Data&quot; &quot;No Data&quot; &quot;Definite AD (Exam)&quot; ...
##  $ AGE_OF_ONSET     : num  43 79 65 57 61 73 71 60 65 75 ...
##  $ AOO_DOC_EST_UNK  : chr  &quot;E&quot; &quot;E&quot; &quot;E&quot; &quot;E&quot; ...
##  $ AGE_OF_DIAGNOSIS : num  NA 79 65 57 64 NA 73 NA 65 75 ...
##  $ AODX_UNKNOWN     : chr  &quot;U&quot; NA NA NA ...
##  $ AD_HX_CATEGORY   : chr  NA NA NA NA ...
##  $ UNCLEAR_CATEGORY : chr  NA NA NA NA ...
##  $ DEMENT_NAME      : chr  NA NA NA NA ...
##  $ CLINICAL_EXAMINER: chr  &quot;katrina/DR. VANCE&quot; &quot;JOSE&quot; &quot;JOSE&quot; &quot;Jose Sanchez&quot; ...
##  $ FOLLOW_UP        : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ AUTOPSY_DISCUSSED: chr  &quot;ND&quot; &quot;N&quot; &quot;ND&quot; &quot;Y&quot; ...
##  $ AUTOPSY_PLANNED  : chr  &quot;ND&quot; &quot;N&quot; &quot;ND&quot; &quot;N&quot; ...
##  $ VERIFY_DATE      : POSIXct, format: NA NA ...
##  $ VERIFY_USER      : chr  NA NA NA &quot;Jose Javier Sanchez&quot; ...
##  $ COMMENTS         : chr  NA NA NA NA ...
##  $ FORM_DATE        : POSIXct, format: &quot;2022-03-29&quot; &quot;2022-03-30&quot; ...
##  $ FILLED_OUT_BY    : chr  &quot;kxc672&quot; &quot;jjs2031&quot; &quot;jjs2031&quot; &quot;jjs2031&quot; ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-5" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_CLINICALSUM&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-4" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## [1] &quot;REFCTR&quot;            &quot;LAST_CONTACT_DATE&quot; &quot;LAST_CONTACT_AGE&quot; 

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 3 × 2
##   VarNames          `Data Type`
##   &lt;chr&gt;             &lt;chr&gt;      
## 1 REFCTR            VARCHAR2(6)
## 2 LAST_CONTACT_DATE DATE       
## 3 LAST_CONTACT_AGE  NUMBER(2)</code></pre>
<pre class="r"><code>## select the vars to be converted to numeric
convert2num &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;NUMBER&quot;, dfDD$`Data Type`)] ## LAST_CONTACT_AGE

## select the vars to be converted to date
convert2date &lt;-  dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;date&quot;,dfDD$`Data Type`,ignore.case = T)] ## LAST_CONTACT_DATE

## the rest should be converted to character
convert2chr &lt;- setdiff(logicols,c(convert2num,convert2date)) ## REFCTR

## convert
df[convert2num] &lt;- lapply(df[convert2num], as.numeric)
df[convert2date] &lt;- lapply(df[convert2date], as.Date)
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-4" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;DATE_OF_BIRTH&quot; &quot;VERIFY_DATE&quot;   &quot;FORM_DATE&quot; 

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## [1] &quot;LAST_CONTACT_DATE&quot; can ignore LAST_CONTACT_DATE, as it has been corrected in previous step</code></pre>
<pre><code>## [1] &quot;LAST_CONTACT_DATE&quot;</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##   DATE_OF_BIRTH VERIFY_DATE  FORM_DATE
## 1    1973-01-14        &lt;NA&gt; 2022-03-29
## 2    1941-04-03        &lt;NA&gt; 2022-03-30
## 3    1955-02-08        &lt;NA&gt; 2022-03-28
## 4    1945-02-17  2022-05-18 2022-03-28
## 5    1958-03-11  2022-05-05 2022-03-29
## 6    1947-02-05  2022-05-05 2022-03-29</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-4" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 20 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## [1] &quot;IMPRESSION&quot;       &quot;AD_CATEGORY&quot;      &quot;AD_HX_CATEGORY&quot;   &quot;UNCLEAR_CATEGORY&quot;
## after checking the unique values of variables in the mismatchChrs_1, I believe that they all should be characters
## so I updated the DD for those variables (I changed their data type in DD and switch the values from &quot;Valid Responses&quot; and &quot; Valid Responses Codes&quot; columns)

mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-49c8bc6a10f5a1035045" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-49c8bc6a10f5a1035045">{"x":{"filter":"none","vertical":false,"data":[["IMPRESSION","AD_CATEGORY","AD_HX_CATEGORY","UNCLEAR_CATEGORY","FILLED_OUT_BY"],["IMPRESSION","AD_CATEGORY","AD_HX_CATEGORY","UNCLEAR_CATEGORY","FILLED_OUT_BY"],["Affected By Exam, Affected By History, Unclear, Unaffected By Exam, Normal By Screen, Unaffected By History, No Data","Definite AD (Exam), Probable AD (Exam), Possible AD (Exam)","Probable AD (History), Possible AD (History), Definite AD (History)","Unclear - MCI, Unclear - Other, Unclear - Demented, Unclear By Screen","kxc672, jjs2031, Celis, Katrina, avg55, v.rodriguez4, prm72, sjt82, mxc2207, axr1589, ALEJANDRA RODRIGUEZ, mxp1257, ERIKA NEGRO, bxf258, plb50, fxs121, jmv184, ALEJANDRA BETACOURT, ascott2, MICHAEL P, Dr Feliciano, pxg275, alejandra betancourt, axl4132, erika negro, Erika Negro, michael p, michael prough, Michael Prough, Dr. Feliciano, MICHAEL PROUGH, gmh86, j.delvilla, M. Prough, Celis, Katrina; Anto"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## the descrption for variable FILLED_OUT_BY mentioned this is Dropdown style for people to select, so I belive that multiple values are fine</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-4" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 15 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA              &quot;1 thru 99999;&quot; &quot;1 thru 9999;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-3f16cf8c283b20f920fb" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3f16cf8c283b20f920fb">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104405, 104418, 104420, 104422, 104428, 104435, 104437, 104438, 104446, 104419, 104424, 104415, 104410, 104423, 104409, 104426, 104411, 104408, 104407, 104432, 104439, 104442, 104445, 104427, 104431, 104406, 104412"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-4" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_CLINICALSUM&lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_csdd" class="section level2">
<h2>ALZ_CSDD</h2>
<pre class="r"><code>df &lt;- ALZ_CSDD

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    181 obs. of  42 variables:
##  $ SYSXM           : num  7555573 7557803 7551403 7550933 7551073 ...
##  $ SYSIND          : num  11006333 11039713 11048273 11063923 11048283 ...
##  $ SYSGP           : num  7888683 7896183 7894423 7894423 7894423 ...
##  $ SYSGPSTUDY      : num  1304023 1311503 1309743 1309743 1309743 ...
##  $ SYSINDGP        : num  7761133 7795453 7804133 7822853 7804143 ...
##  $ CGI_ORDER       : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER       : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER    : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY          : chr  &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ DB_OWNER        : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY           : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY        : chr  &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ CENTER          : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP              : num  87535 87657 87650 87650 87650 ...
##  $ IND             : num  1001 1 105 110 106 ...
##  $ REFCTR          : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE       : POSIXct, format: &quot;2018-04-13&quot; &quot;2018-04-17&quot; ...
##  $ EXAMINER        : chr  &quot;axr1589&quot; &quot;axr1589&quot; &quot;axr1589&quot; &quot;axr1589&quot; ...
##  $ DATE_OF_BIRTH   : POSIXct, format: &quot;1932-02-20&quot; &quot;1947-04-23&quot; ...
##  $ AGE_AT_EXAM     : num  86 70 77 86 82 87 87 85 75 80 ...
##  $ ANXIETY         : num  2 0 0 0 0 2 -1 0 2 1 ...
##  $ SADNESS         : num  0 0 0 0 0 0 -1 2 0 1 ...
##  $ LACK_REACTION   : num  0 1 2 0 0 -1 -1 0 1 1 ...
##  $ IRRITABILITY    : num  1 0 0 2 0 0 -1 0 2 1 ...
##  $ AGITATION       : num  1 0 0 0 0 2 -1 0 1 0 ...
##  $ RETARDATION     : num  0 2 1 1 0 2 -1 0 0 1 ...
##  $ MULTI_COMPLAINTS: num  2 0 1 2 0 -1 -1 0 1 1 ...
##  $ LOSS_INTEREST   : num  1 0 2 0 0 -1 -1 0 2 0 ...
##  $ LOSS_APPETITE   : num  0 1 1 1 0 2 -1 1 1 1 ...
##  $ LOSS_WEIGHT     : num  0 0 2 2 1 2 -1 -1 1 0 ...
##  $ LACK_ENERGY     : num  2 0 2 1 1 2 -1 2 2 1 ...
##  $ DIURNAL_MOOD    : num  1 0 0 -1 0 2 -1 0 -1 0 ...
##  $ DIFF_ASLEEP     : num  0 0 0 0 0 2 -1 0 0 1 ...
##  $ MULTI_AWAKEN    : num  0 1 1 0 0 2 -1 0 0 0 ...
##  $ EARLY_AWAKEN    : num  0 0 1 0 1 0 -1 0 1 0 ...
##  $ SUICIDAL        : num  0 0 0 0 0 -1 -1 0 -1 0 ...
##  $ SELF_ESTEEM     : num  0 0 0 0 0 -1 -1 0 -1 0 ...
##  $ PESSIMISM       : num  0 0 0 0 0 -1 -1 0 -1 0 ...
##  $ MOOD_DELUSIONS  : num  0 0 0 0 0 -1 -1 0 -1 0 ...
##  $ NOTES_MEDS      : chr  NA NA NA NA ...
##  $ CSDD_SCORE      : num  10 5 13 9 3 18 0 5 14 9 ...
##  $ CSDD_COUNT      : num  19 19 19 18 19 12 0 18 14 19 ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-6" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_CSDD&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-5" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## 1

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 1 × 2
##   VarNames `Data Type`
##   &lt;chr&gt;    &lt;chr&gt;      
## 1 REFCTR   VARCHAR2(6)</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;- c(&quot;REFCTR&quot;)

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-5" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot;

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH
## 1 2018-04-13    1932-02-20
## 2 2018-04-17    1947-04-23
## 3 2018-03-15    1940-06-24
## 4 2018-04-03    1931-07-01
## 5 2018-04-03    1935-05-25
## 6 2018-04-24    1930-06-19</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-5" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 8 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<pre><code>## All values are within valid ranges.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-bbe33d2cc60e3cbbc63f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-bbe33d2cc60e3cbbc63f">{"x":null,"evals":[],"jsHooks":[]}</script>
<p><br></p>
</div>
<div id="handling-numeric-variables-5" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 32 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA                      &quot;1 thru 99999;&quot;         &quot;1 thru 9999;&quot;         
## [4] &quot;-1;\r\n0;\r\n1;\r\n2;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-cafae75fbcce3ee07084" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cafae75fbcce3ee07084">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104405"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-5" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_CSDD &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_exam" class="section level2">
<h2>ALZ_EXAM</h2>
<pre class="r"><code>df &lt;- ALZ_EXAM

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    526 obs. of  80 variables:
##  $ SYSXM               : num  7541263 7541363 7541493 7540523 7541543 ...
##  $ SYSIND              : num  11109753 11109763 11109783 11048913 11109793 ...
##  $ SYSGP               : num  7921103 7921113 7921133 7896183 7921143 ...
##  $ SYSGPSTUDY          : num  1359213 1359223 1359243 1311503 1359253 ...
##  $ SYSINDGP            : num  7869273 7869283 7869303 7804773 7869313 ...
##  $ CGI_ORDER           : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER           : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER        : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY              : chr  &quot;ADCRLPRADI&quot; &quot;ADCONTROL&quot; &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ DB_OWNER            : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY               : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY            : chr  &quot;ADCRLPRADI&quot; &quot;ADCONTROL&quot; &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ CENTER              : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP                  : num  87787 87788 87790 87657 87791 ...
##  $ IND                 : num  1 1 1 102 1 1 1 1 1 1 ...
##  $ REFCTR              : logi  NA NA NA NA NA NA ...
##  $ FORM_DATE           : POSIXct, format: &quot;2018-03-06&quot; &quot;2018-03-06&quot; ...
##  $ FILLED_OUT_BY       : chr  &quot;v.rodriguez4&quot; &quot;bxf258&quot; &quot;v.rodriguez4&quot; &quot;v.rodriguez4&quot; ...
##  $ DATE_OF_BIRTH       : POSIXct, format: &quot;1950-06-30&quot; &quot;1956-12-21&quot; ...
##  $ NEURO_METHOD        : chr  &quot;E&quot; &quot;E&quot; &quot;E&quot; &quot;E&quot; ...
##  $ NEURO_EXAM_DATE     : POSIXct, format: &quot;2018-03-06&quot; &quot;2018-03-06&quot; ...
##  $ NEURO_EXAMINER      : chr  &quot;vanessa r&quot; &quot;briseida felicia&quot; &quot;vanessa&quot; &quot;Vanessa&quot; ...
##  $ MOOD_AFFECT         : chr  &quot;N&quot; &quot;N&quot; &quot;A&quot; &quot;N&quot; ...
##  $ DEPRESSED           : chr  NA NA &quot;Y&quot; NA ...
##  $ MANIC               : chr  NA NA &quot;N&quot; NA ...
##  $ MOOD_OTHER          : chr  NA NA &quot;N&quot; NA ...
##  $ MOOD_OTHER_DSC      : chr  NA NA NA NA ...
##  $ SPEECH              : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ DYSARTHRIA          : chr  NA NA NA NA ...
##  $ DYSPHASIA           : chr  NA NA NA NA ...
##  $ SPEECH_OTHER        : chr  NA NA NA NA ...
##  $ SPEECH_OTHER_DSC    : chr  NA NA NA NA ...
##  $ FACIAL_EXPRESSION   : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ MASKED_FACE         : chr  NA NA NA NA ...
##  $ FACIAL_OTHER        : chr  NA NA NA NA ...
##  $ FACIAL_OTHER_DSC    : chr  NA NA NA NA ...
##  $ OCULAR_MOVEMENT     : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ IMPAIRED_UPGAZE     : chr  NA NA NA NA ...
##  $ OCULAR_OTHER        : chr  NA NA NA NA ...
##  $ OCULAR_OTHER_DSC    : chr  NA NA NA NA ...
##  $ BRADY               : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ BRADY_GLOBAL        : chr  NA NA NA NA ...
##  $ SLOWED_RAMS         : chr  NA NA NA NA ...
##  $ BRADY_OTHER         : chr  NA NA NA NA ...
##  $ BRADY_OTHER_DSC     : chr  NA NA NA NA ...
##  $ TREMOR              : chr  &quot;Y&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ TREMOR_RESTING      : chr  &quot;N&quot; NA NA NA ...
##  $ TREMOR_ACTION       : chr  &quot;Y&quot; NA NA NA ...
##  $ GAIT                : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ DECR_ARM_SWING      : chr  NA NA NA NA ...
##  $ SHUFFLING           : chr  NA NA NA NA ...
##  $ MULTI_STEP          : chr  NA NA NA NA ...
##  $ GAIT_OTHER          : chr  NA NA NA NA ...
##  $ GAIT_OTHER_DSC      : chr  NA NA NA NA ...
##  $ POST_STABILITY      : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ MOTOR_TONE          : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ RIGIDITY            : chr  NA NA NA NA ...
##  $ COGWHEELING         : chr  NA NA NA NA ...
##  $ SPASTICITY          : chr  NA NA NA NA ...
##  $ FLACCIDITY          : chr  NA NA NA NA ...
##  $ MOTOR_ASYM          : chr  &quot;ND&quot; &quot;ND&quot; &quot;ND&quot; &quot;ND&quot; ...
##  $ REFLEXES_ASYM       : chr  &quot;ND&quot; &quot;N&quot; &quot;ND&quot; &quot;ND&quot; ...
##  $ REFLEXES_HYPERACTIVE: chr  &quot;ND&quot; &quot;N&quot; &quot;ND&quot; &quot;ND&quot; ...
##  $ REFLEXES_DECREASED  : chr  &quot;ND&quot; &quot;N&quot; &quot;ND&quot; &quot;ND&quot; ...
##  $ BABINSKI            : chr  &quot;ND&quot; &quot;N&quot; &quot;ND&quot; &quot;ND&quot; ...
##  $ CLIN_METHOD         : chr  &quot;E&quot; &quot;E&quot; &quot;E&quot; &quot;E&quot; ...
##  $ CLIN_EXAM_DATE      : POSIXct, format: &quot;2018-03-06&quot; &quot;2018-03-06&quot; ...
##  $ CLIN_EXAMINER       : chr  &quot;vanessa r&quot; &quot;briseida&quot; NA &quot;Vanessa&quot; ...
##  $ PROG_APHASIA        : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ AMNESIA             : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ LUNG_DX             : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ PREV_ARREST         : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ SUBSTANCE_ABUSE     : chr  &quot;Y&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ SURGERY             : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ VAS_DEMENTIA        : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ PSY_DISORDER        : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ FLUCT_COGNITION     : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ DOPAMINE            : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ DOPA_CURRENT        : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ NEUROLEPTIC         : chr  &quot;N&quot; &quot;U&quot; &quot;N&quot; &quot;U&quot; ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-7" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_EXAM&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-6" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## REFCTR

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 1 × 2
##   VarNames `Data Type`
##   &lt;chr&gt;    &lt;chr&gt;      
## 1 REFCTR   VARCHAR2(6)</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;-c(&quot;REFCTR&quot;)

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-6" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;FORM_DATE&quot;       &quot;DATE_OF_BIRTH&quot;   &quot;NEURO_EXAM_DATE&quot; &quot;CLIN_EXAM_DATE&quot; 

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    FORM_DATE DATE_OF_BIRTH NEURO_EXAM_DATE CLIN_EXAM_DATE
## 1 2018-03-06    1950-06-30      2018-03-06     2018-03-06
## 2 2018-03-06    1956-12-21      2018-03-06     2018-03-06
## 3 2018-03-06    1946-10-29      2018-03-06     2018-03-06
## 4 2018-02-19    1946-01-11      2018-02-19     2018-02-19
## 5 2018-03-06    1949-10-06      2018-03-06     2018-03-06
## 6 2018-03-05    1938-11-06      2018-03-05     2018-03-05</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-6" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 66 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-8b3637d3a466026b1882" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8b3637d3a466026b1882">{"x":{"filter":"none","vertical":false,"data":[["FILLED_OUT_BY","NEURO_METHOD"],["FILLED_OUT_BY","NEURO_METHOD"],["v.rodriguez4, bxf258, avg55, kxc672, axr1589, ALEJANDRA BETACOURT, ALEJANDRA, sjt82, prm72, NEREIDA FELICIANO, sek100, mxp1257, mpericak, mxc2207, Erika Negro, patricia manrique, pxg275, patricia m, jjs2031","M  E"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore NEURO_METHOD and FILLED_OUT_BY</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-6" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 10 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA              &quot;1 thru 99999;&quot; &quot;1 thru 9999;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-096db5f835fdf6a59972" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-096db5f835fdf6a59972">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104425, 104402, 104403"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-6" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_EXAM &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_gai_sp" class="section level2">
<h2>ALZ_GAI_SP</h2>
<pre class="r"><code>df &lt;- ALZ_GAI_SP

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    19 obs. of  42 variables:
##  $ SYSXM               : num  8095923 8103313 8089823 8065953 8066073 ...
##  $ SYSIND              : num  11008753 11147113 11008763 11358523 11369753 ...
##  $ SYSGP               : num  7888993 7922413 7888993 7945143 7951963 ...
##  $ SYSGPSTUDY          : num  1304333 1360523 1304333 1386053 1397073 ...
##  $ SYSINDGP            : num  7763553 7910223 7763563 8127793 8139023 ...
##  $ CGI_ORDER           : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER           : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER        : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY              : chr  &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ DB_OWNER            : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY               : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY            : chr  &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ CENTER              : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP                  : num  87577 87858 87577 88247 88316 ...
##  $ IND                 : num  9000 103 9001 1 1 ...
##  $ REFCTR              : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE           : POSIXct, format: &quot;2022-07-12&quot; &quot;2022-07-14&quot; ...
##  $ EXAMINER            : chr  &quot;mxc2207&quot; &quot;jjs2031&quot; &quot;jjs2031&quot; &quot;mxc2207&quot; ...
##  $ DATE_OF_BIRTH       : POSIXct, format: &quot;1944-10-12&quot; &quot;1939-04-08&quot; ...
##  $ AGE_AT_EXAM         : num  77 83 61 75 85 81 71 80 52 62 ...
##  $ REVIEW_DATE         : logi  NA NA NA NA NA NA ...
##  $ REVIEWER            : logi  NA NA NA NA NA NA ...
##  $ WORRY_ALOT          : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ DIFF_MAKE_DECISION  : num  1 0 0 0 0 0 0 1 0 1 ...
##  $ FEEL_JUMPY          : num  1 0 0 0 0 0 0 1 0 0 ...
##  $ HARD_TO_RELAX       : num  0 0 0 0 0 0 0 1 0 0 ...
##  $ CANNOT_ENJOY        : num  1 0 0 0 0 0 0 0 0 0 ...
##  $ THINGS_BOTHER_ME    : num  1 0 0 0 0 0 0 0 0 1 ...
##  $ BUTTERFLIES         : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ WORRIER             : num  0 0 0 1 1 1 0 1 1 1 ...
##  $ RIVIAL_THINGS       : num  0 0 0 1 0 0 0 1 1 1 ...
##  $ OFTEN_NERVOUS       : num  1 1 0 0 1 0 0 0 1 0 ...
##  $ THOUGHTS_ANXIOUS    : num  1 0 0 0 0 0 0 0 0 0 ...
##  $ UPSET_STOMACH       : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ THINK_MYSELF_NERVOUS: num  0 0 0 1 0 0 0 1 0 0 ...
##  $ ANTICIPATE_WORST    : num  1 0 0 0 0 0 0 1 0 0 ...
##  $ FEEL_SHAKY          : num  1 0 0 0 0 0 0 1 0 0 ...
##  $ INTERFERE_WITH_LIFE : num  1 0 0 0 0 0 0 0 0 0 ...
##  $ OVERWHELM           : num  1 0 0 0 0 0 0 0 0 0 ...
##  $ FEEL_GREAT_KNOT     : num  1 0 0 0 0 0 0 0 0 0 ...
##  $ MISS_OUT            : num  1 0 0 0 1 0 0 0 0 0 ...
##  $ FEEL_UPSET          : num  1 0 0 0 0 0 0 0 0 0 ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-8" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_GAI_SP&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-7" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## [1] &quot;REFCTR&quot;      &quot;REVIEW_DATE&quot; &quot;REVIEWER&quot; 

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 3 × 2
##   VarNames    `Data Type`
##   &lt;chr&gt;       &lt;chr&gt;      
## 1 REFCTR      VARCHAR2(6)
## 2 REVIEW_DATE date       
## 3 REVIEWER    VARCHAR</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;-c(&quot;REFCTR&quot;,&quot;REVIEWER&quot;)
convert2date &lt;- c(&quot;REVIEW_DATE&quot;)

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)
df[convert2date] &lt;- lapply(df[convert2date], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-7" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot; 

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## &quot;REVIEW_DATE, ignore it, since it has been converted in previous step</code></pre>
<pre><code>## [1] &quot;REVIEW_DATE&quot;</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH
## 1 2022-07-12    1944-10-12
## 2 2022-07-14    1939-04-08
## 3 2022-07-12    1961-06-12
## 4 2022-04-01    1946-10-06
## 5 2022-03-31    1936-12-21
## 6 2022-03-30    1940-06-12</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-7" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)]
## [1] &quot;LSTUDY&quot;   &quot;DB_OWNER&quot; &quot;STUDY&quot;    &quot;SUBSTUDY&quot; &quot;CENTER&quot;   &quot;REFCTR&quot;   &quot;EXAMINER&quot; &quot;REVIEWER&quot;

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-9a2608b3a67ea1399249" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9a2608b3a67ea1399249">{"x":{"filter":"none","vertical":false,"data":[["EXAMINER"],["EXAMINER"],["mxc2207, jjs2031, cmanrique"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore EXAMINER, as I assume we can have multiple examiners</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-7" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 31 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA              &quot;1 thru 99999;&quot; &quot;1 thru 9999;&quot;  &quot;1;\r\n0;\r\n&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<pre><code>## All numeric values are within valid ranges.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-9d28a60949585f087194" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9d28a60949585f087194">{"x":null,"evals":[],"jsHooks":[]}</script>
<p><br></p>
</div>
<div id="save-cleaned-data-7" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_GAI_SP &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_load_cog" class="section level2">
<h2>ALZ_LOAD_COG</h2>
<pre class="r"><code>df &lt;- ALZ_LOAD_COG

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    1006 obs. of  41 variables:
##  $ SYSXM         : num  7540463 7540813 7540903 7540593 7541233 ...
##  $ SYSIND        : num  11006263 11059623 11059693 11048913 11109753 ...
##  $ SYSGP         : num  7888673 7897223 7897223 7896183 7921103 ...
##  $ SYSGPSTUDY    : num  1304013 1312543 1312543 1311503 1359213 ...
##  $ SYSINDGP      : num  7761063 7818553 7818623 7804773 7869273 ...
##  $ CGI_ORDER     : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER     : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER  : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY        : chr  &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ DB_OWNER      : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY         : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY      : chr  &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ CENTER        : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP            : num  87534 87699 87699 87657 87787 ...
##  $ IND           : num  104 101 108 102 1 1 1 1 1 1 ...
##  $ REFCTR        : logi  NA NA NA NA NA NA ...
##  $ INTERVIEW_DATE: POSIXct, format: &quot;2018-02-21&quot; &quot;2018-02-18&quot; ...
##  $ INTERVIEWER   : chr  &quot;v.rodriguez4&quot; &quot;axr1589&quot; &quot;axr1589&quot; &quot;v.rodriguez4&quot; ...
##  $ DATE_OF_BIRTH : POSIXct, format: &quot;1936-09-20&quot; &quot;1929-10-08&quot; ...
##  $ INTERVIEW_AGE : num  81 88 68 72 67 61 68 68 79 65 ...
##  $ VERSION       : chr  &quot;2.0&quot; &quot;2.0&quot; &quot;2&quot; &quot;2.0&quot; ...
##  $ PHONE         : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STORY         : num  6 3 4 6 18 19 9 1 9 12 ...
##  $ DIGFOR        : num  9 5 8 10 9 12 8 8 3 7 ...
##  $ DIGBAK        : num  6 5 7 4 7 6 4 0 2 5 ...
##  $ ANIMALS       : num  16 11 20 14 15 17 7 13 NA 13 ...
##  $ FRUITS        : logi  NA NA NA NA NA NA ...
##  $ VEG           : num  13 6 12 5 14 7 5 7 NA 6 ...
##  $ DIGORD        : num  7 2 4 5 8 8 7 0 NA 7 ...
##  $ DELAY         : num  8 0 6 3 12 17 7 0 NA 5 ...
##  $ HOWWELL       : num  NA NA 1 NA 1 1 1 9 1 1 ...
##  $ HEARIMP       : num  NA NA 2 NA 2 2 2 2 2 2 ...
##  $ STATUS        : num  1 1 1 1 1 1 1 1 4 1 ...
##  $ COMM          : chr  NA NA NA NA ...
##  $ ANIMALS_REP   : logi  NA NA NA NA NA NA ...
##  $ ANIMALS_INT   : logi  NA NA NA NA NA NA ...
##  $ VEG_REP       : logi  NA NA NA NA NA NA ...
##  $ VEG_INT       : logi  NA NA NA NA NA NA ...
##  $ DIGFOR_LEN    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DIGBAK_LEN    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DELAY_LEN     : num  NA NA NA NA NA NA NA NA NA NA ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-9" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_LOAD_COG&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-8" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## [1] &quot;REFCTR&quot;      &quot;FRUITS&quot;      &quot;ANIMALS_REP&quot; &quot;ANIMALS_INT&quot; &quot;VEG_REP&quot;     &quot;VEG_INT&quot; 

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 6 × 2
##   VarNames    `Data Type`
##   &lt;chr&gt;       &lt;chr&gt;      
## 1 REFCTR      VARCHAR2(6)
## 2 FRUITS      NUMBER     
## 3 ANIMALS_REP &lt;NA&gt;       
## 4 ANIMALS_INT &lt;NA&gt;       
## 5 VEG_REP     &lt;NA&gt;       
## 6 VEG_INT     &lt;NA&gt;</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;-c(&quot;REFCTR&quot;)
convert2num &lt;-c(&quot;FRUITS&quot;)

## for others, they are missing info in DD, I will leave them for now

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)
df[convert2num] &lt;- lapply(df[convert2chr], as.numeric)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;logical&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-8" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot;

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##   INTERVIEW_DATE DATE_OF_BIRTH
## 1     2018-02-21    1936-09-20
## 2     2018-02-18    1929-10-08
## 3     2018-02-19    1949-08-01
## 4     2018-02-19    1946-01-11
## 5     2018-03-06    1950-06-30
## 6     2018-03-06    1956-12-21</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;      &quot;logical&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-8" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 9 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-4a54e9165675893baa44" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4a54e9165675893baa44">{"x":{"filter":"none","vertical":false,"data":[["INTERVIEWER"],["INTERVIEWER"],["v.rodriguez4, axr1589, michael p, bxf258, avg55, ALEJANDRA BETACOURT, kxc672, plb50, sjt82, prm72, MP, AS, M PROUGH, UCC, Cdel, OG, CDL, ascott2, ALEJANDRA, RMC, NEREIDA FELICIANO, erika, mxc2207, Erika Negro, pxg275, mxp1257, fxs121, A Grana, MICHAEL P, erica, jjs2031, axl4132, patricia m, jmv184, patricia manrique, cmanrique, Maricarmen Contreras"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore INTERVIEWER</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-8" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 26 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>##  [1] NA                                                                     
##  [2] &quot;1 thru 99999;&quot;                                                        
##  [3] &quot;1 thru 9999;&quot;                                                         
##  [4] &quot;1;\r\n2;\r\n8;\r\n9;&quot;                                                 
##  [5] &quot;0 thru 25;\r\n96;\r\n97;\r\n98;\r\n99;&quot;                               
##  [6] &quot;0 thru 12;\r\n96;\r\n97;\r\n98;\r\n99;&quot;                               
##  [7] &quot;0 thru 75;\r\n96;\r\n97;\r\n98;\r\n99;&quot;                               
##  [8] &quot;0 thru 16;\r\n96;\r\n97;\r\n98;\r\n99;&quot;                               
##  [9] &quot;1;\r\n2;\r\n3;\r\n4;\r\n5;\r\n8;\r\n9;&quot;                               
## [10] &quot;1;\r\n2;&quot;                                                             
## [11] &quot;1;\r\n2;\r\n3;\r\n4;\r\n10;\r\n11;\r\n12;\r\n13;\r\n14;\r\n20;\r\n21;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-08f2853806e0ab5653d0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-08f2853806e0ab5653d0">{"x":{"filter":"none","vertical":false,"data":[["GP","PHONE"],["GP","PHONE"],["104406, 104418, 104420, 104405, 104446, 104442, 104423, 104403, 104404, 104438, 104419, 104409, 104408, 104431, 104429, 104433, 104434, 104413, 104416, 104436, 104425, 104421, 104440, 104430, 104443, 104424, 104415, 104441, 104414, 104402, 104422, 104428, 104435, 104437, 104412, 104411, 104407, 104432, 104439, 104445, 104427, 104410, 104426","3"],["1 - 99999","1;2;8;9"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-8" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_LOAD_COG &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_ncrad" class="section level2">
<h2>ALZ_NCRAD</h2>
<pre class="r"><code>df &lt;- ALZ_NCRAD

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    743 obs. of  53 variables:
##  $ SYSXM        : num  7895163 7879963 7879983 7880163 7880193 ...
##  $ SYSIND       : num  11218613 11041143 11041043 11039473 11005233 ...
##  $ SYSGP        : num  7928123 7894373 7894373 7896023 7888553 ...
##  $ SYSGPSTUDY   : num  1366233 1309693 1309693 1311343 1303893 ...
##  $ SYSINDGP     : num  7981883 7797003 7796903 7795213 7760033 ...
##  $ CGI_ORDER    : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER    : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY       : chr  &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ DB_OWNER     : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY        : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY     : chr  &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ CENTER       : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP           : num  87998 87502 87502 87506 87501 ...
##  $ IND          : num  1 102 100 1 1 1 1 1 1 1 ...
##  $ REFCTR       : logi  NA NA NA NA NA NA ...
##  $ QUALIFY      : chr  &quot;Unknown&quot; &quot;Yes&quot; &quot;Yes&quot; &quot;Yes&quot; ...
##  $ FORM_DATE    : POSIXct, format: &quot;2021-02-01&quot; &quot;2018-04-13&quot; ...
##  $ FILLED_OUT_BY: chr  &quot;sjt82&quot; &quot;v.rodriguez4&quot; &quot;v.rodriguez4&quot; &quot;medical records&quot; ...
##  $ DATE_OF_BIRTH: POSIXct, format: &quot;1943-09-22&quot; &quot;1950-10-02&quot; ...
##  $ IN_NCRAD     : chr  NA NA NA NA ...
##  $ SAMPLED      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ EDUC         : num  14 12 16 9 12 1 5 16 3 15 ...
##  $ VISIT        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ COMREQ       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ NOTDEMCI     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ EVALMETH     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ EVALYR       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ CLDEMLEW     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ COMDXAD      : logi  NA NA NA NA NA NA ...
##  $ NONADDEM     : logi  NA NA NA NA NA NA ...
##  $ COMDXNAD     : logi  NA NA NA NA NA NA ...
##  $ AAOSYMP      : num  NA NA NA NA 1 1 NA NA NA NA ...
##  $ STROKETY     : logi  NA NA NA NA NA NA ...
##  $ STROKEAGE    : logi  NA NA NA NA NA NA ...
##  $ HYPERAGE     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ HEARTAGE     : logi  NA NA NA NA NA NA ...
##  $ DIABETX      : logi  NA NA NA NA NA NA ...
##  $ DIABETAG     : logi  NA NA NA NA NA NA ...
##  $ PDCLINDX     : logi  NA NA NA NA NA NA ...
##  $ PDAGE        : logi  NA NA NA NA NA NA ...
##  $ DEPRTX       : logi  NA NA NA NA NA NA ...
##  $ DEPRAGE      : logi  NA NA NA NA NA NA ...
##  $ HEADAGE      : logi  NA NA NA NA NA NA ...
##  $ ABUSEAGE     : logi  NA NA NA NA NA NA ...
##  $ COM28_36     : logi  NA NA NA NA NA NA ...
##  $ COM_ANY      : chr  NA NA NA NA ...
##  $ CONTROL      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ CONTYPE      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ RELDEM       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ GENRSCH      : num  2 2 2 2 2 2 2 2 2 2 ...
##  $ UNCON_VAL    : logi  NA NA NA NA NA NA ...
##  $ UNCON_UNIT   : logi  NA NA NA NA NA NA ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-10" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_NCRAD&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-9" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## 18 vars 

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 18 × 2
##    VarNames   `Data Type`  
##    &lt;chr&gt;      &lt;chr&gt;        
##  1 REFCTR     VARCHAR2(6)  
##  2 COMDXAD    VARCHAR2(255)
##  3 NONADDEM   NUMBER(2)    
##  4 COMDXNAD   VARCHAR2(255)
##  5 STROKETY   NUMBER(1)    
##  6 STROKEAGE  NUMBER(3)    
##  7 HEARTAGE   NUMBER(3)    
##  8 DIABETX    NUMBER(1)    
##  9 DIABETAG   NUMBER(3)    
## 10 PDCLINDX   NUMBER(1)    
## 11 PDAGE      NUMBER(3)    
## 12 DEPRTX     NUMBER(1)    
## 13 DEPRAGE    NUMBER(3)    
## 14 HEADAGE    NUMBER(3)    
## 15 ABUSEAGE   NUMBER(3)    
## 16 COM28_36   VARCHAR2(255)
## 17 UNCON_VAL  NUMBER(3)    
## 18 UNCON_UNIT VARCHAR2(7)</code></pre>
<pre class="r"><code>## converted to character
convert2num &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;NUMBER&quot;, dfDD$`Data Type`)] ## 13 vars
convert2chr &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;CHAR&quot;, dfDD$`Data Type`)] ## 5 vars

## convert
df[convert2num] &lt;- lapply(df[convert2chr], as.numeric)
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-9" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;FORM_DATE&quot;     &quot;DATE_OF_BIRTH&quot;

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    FORM_DATE DATE_OF_BIRTH
## 1 2021-02-01    1943-09-22
## 2 2018-04-13    1950-10-02
## 3 2020-04-23    1949-04-30
## 4 2016-11-17    1933-03-03
## 5 2019-05-22    1937-10-24
## 6 2020-09-17    1935-10-25</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-9" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 14 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-a91c1f52e2d4d9297e36" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a91c1f52e2d4d9297e36">{"x":{"filter":"none","vertical":false,"data":[["FILLED_OUT_BY"],["FILLED_OUT_BY"],["sjt82, v.rodriguez4, medical records, mxc2207, Erika Negro, prm72, avg55, mxp1257, ERIKA NEGRO, jjs2031, axr1589, kxc672, Erika NEgro, medical record, axl4132, bxf258, erika negro, fxs121, plb50, ajennings, jmv184"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore FILLED_OUT_BY</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-9" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 37 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>##  [1] NA                                                                                                                 
##  [2] &quot;1 thru 99999;&quot;                                                                                                    
##  [3] &quot;1 thru 9999;&quot;                                                                                                     
##  [4] &quot;1;\r\n2;&quot;                                                                                                         
##  [5] &quot;0 thru 50;\r\n99;&quot;                                                                                                
##  [6] &quot;1 thru 50;\r\n98;&quot;                                                                                                
##  [7] &quot;1;\r\n2;\r\n3;\r\n9;&quot;                                                                                             
##  [8] &quot;1;\r\n2;\r\n3;\r\n4;\r\n5;\r\n6;\r\n9;&quot;                                                                           
##  [9] &quot;1;\r\n2;\r\n3;\r\n4;\r\n5;\r\n6;\r\n7;\r\n9;&quot;                                                                     
## [10] &quot;1930 thru 2020;\r\n9999;&quot;                                                                                         
## [11] &quot;1;\r\n2;\r\n9;&quot;                                                                                                   
## [12] &quot;1;\r\n2;\r\n3;\r\n4;\r\n5;\r\n6;\r\n7;\r\n8;\r\n9;\r\n10;\r\n11;\r\n12;\r\n13;\r\n14;\r\n15;\r\n16;\r\n17;\r\n99;&quot;
## [13] &quot;1;\r\n2;\r\n3;\r\n4;\r\n5;\r\n6;\r\n7;\r\n8;\r\n9;&quot;                                                               
## [14] &quot;1 thru 80;\r\n999;&quot;                                                                                               
## [15] &quot;1;\r\n2;\r\n3;\r\n4;\r\n5;\r\n9;&quot;                                                                                 
## [16] &quot;1;\r\n2;\r\n3;\r\n4;\r\n9;\r\n&quot;                                                                                   
## [17] &quot;1;\r\n2; \r\n3;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-8f2d965fe79bd843139f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8f2d965fe79bd843139f">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104406, 104422, 104428, 104435, 104437, 104446, 104411, 104408, 104418, 104407, 104445, 104427, 104438, 104415, 104419, 104409, 104421, 104431, 104432, 104439, 104420, 104423, 104424, 104442, 104412, 104426, 104405, 104433, 104403, 104429, 104444"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-9" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_NCRAD &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_neuro_cdr" class="section level2">
<h2>ALZ_NEURO_CDR</h2>
<pre class="r"><code>df &lt;- ALZ_NEURO_CDR

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    1221 obs. of  30 variables:
##  $ SYSXM        : num  7540623 7540773 7546423 7546433 7546863 ...
##  $ SYSIND       : num  11048883 11059623 11044293 11011053 11046873 ...
##  $ SYSGP        : num  7896183 7897223 7894093 7889553 7894313 ...
##  $ SYSGPSTUDY   : num  1311503 1312543 1309413 1304893 1309633 ...
##  $ SYSINDGP     : num  7804743 7818553 7800153 7766073 7802733 ...
##  $ CGI_ORDER    : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER    : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY       : chr  &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ DB_OWNER     : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY        : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY     : chr  &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ CENTER       : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP           : num  87657 87699 87604 87580 87620 ...
##  $ IND          : num  1000 101 104 9010 101 106 110 1 102 1 ...
##  $ REFCTR       : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE    : POSIXct, format: &quot;2017-02-19&quot; &quot;2018-02-18&quot; ...
##  $ EXAMINER     : chr  &quot;axr1589&quot; &quot;axr1589&quot; &quot;avg55&quot; &quot;v.rodriguez4&quot; ...
##  $ DATE_OF_BIRTH: POSIXct, format: &quot;1923-04-17&quot; &quot;1929-10-08&quot; ...
##  $ AGE_AT_EXAM  : num  93 88 80 75 76 56 86 84 86 91 ...
##  $ METHOD       : chr  &quot;IP&quot; &quot;IP&quot; &quot;TE&quot; &quot;TE&quot; ...
##  $ RECONSTRUCTED: chr  &quot;U&quot; &quot;U&quot; &quot;N&quot; &quot;N&quot; ...
##  $ CDR_TOTAL    : num  2 2 3 2 1 1 0.5 3 3 2 ...
##  $ MEMORY       : num  2 2 3 2 0.5 2 0.5 3 3 2 ...
##  $ ORIENTATION  : num  2 2 3 1 1 1 0.5 3 3 1 ...
##  $ PROBLEM_SOLVE: num  2 1 3 3 1 2 0 3 3 3 ...
##  $ COM_AFFAIR   : num  2 1 3 2 0.5 1 0 3 3 1 ...
##  $ HOME_HOBBIES : num  2 3 3 3 3 1 0.5 3 3 2 ...
##  $ PERSONAL_CARE: num  3 2 3 2 2 1 0 3 3 2 ...
##  $ CDR_COMM     : chr  NA NA &quot;Too impaired to complete patient portion.&quot; &quot;spoke with daughter about her mother, she is not able to keep a conversation. Barely functions with in the hous&quot;| __truncated__ ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-11" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_NEURO_CDR&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-10" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## REFCTR

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 1 × 2
##   VarNames `Data Type`
##   &lt;chr&gt;    &lt;chr&gt;      
## 1 REFCTR   VARCHAR2(6)</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;CHAR&quot;, dfDD$`Data Type`)]

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-10" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot;

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH
## 1 2017-02-19    1923-04-17
## 2 2018-02-18    1929-10-08
## 3 2018-03-16    1937-04-09
## 4 2018-03-20    1942-07-16
## 5 2018-03-06    1942-02-05
## 6 2018-04-03    1961-10-19</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-10" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 10 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-51cdc859c74fb7f7bc25" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-51cdc859c74fb7f7bc25">{"x":{"filter":"none","vertical":false,"data":[["EXAMINER"],["EXAMINER"],["axr1589, avg55, v.rodriguez4, kxc672, sjt82, ascott2, prm72, bxf258, plb50, PEDRO MENA, OG, PM, AS, UCC, MP, M. prough, Patricia, erica, A Grana, Dr NIT, NEREIDA FELICIANO, M PROGUH, M PROUGH, PLB, mxc2207, Erika Negro, mxp1257, PATRICIA, pxg275, erika, Maricarmen Contreras, fxs121, erika negro, ERIKA NEGRO, mciliberti, ERIKA N, ERIKA, erika negron, ERIKA NEGRON, jjs2031, axl4132, mcuccaro, jmv184, joycelyn, gsv32, cmanrique"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore FILLED_OUT_BY</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-10" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 18 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA                     &quot;1 thru 99999;&quot;        &quot;1 thru 9999;&quot;        
## [4] &quot;0.0 thru 3.4;\r\n-1;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-8d4394a8ebba982174fd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8d4394a8ebba982174fd">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104418, 104420, 104405, 104422, 104406, 104442, 104445, 104427, 104410, 104426, 104423, 104438, 104419, 104409, 104431, 104408, 104424, 104439, 104415, 104428, 104435, 104437, 104446, 104412, 104411, 104407, 104432, 104443, 104425, 104404, 104403, 104429, 104433, 104413, 104434, 104436, 104430, 104402, 104441, 104444, 104421, 104440, 104401, 104416, 104414"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-10" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_NEURO_CDR &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_npiq_cbrs" class="section level2">
<h2>ALZ_NPIQ_CBRS</h2>
<pre class="r"><code>df &lt;- ALZ_NPIQ_CBRS

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    123 obs. of  116 variables:
##  $ SYSXM         : num  7545813 7557843 7550923 7551043 7558333 ...
##  $ SYSIND        : num  11039643 11039713 11063923 11048283 11039953 ...
##  $ SYSGP         : num  7896143 7896183 7894423 7894423 7896303 ...
##  $ SYSGPSTUDY    : num  1311463 1311503 1309743 1309743 1311623 ...
##  $ SYSINDGP      : num  7795383 7795453 7822853 7804143 7795693 ...
##  $ CGI_ORDER     : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER     : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER  : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY        : chr  &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ DB_OWNER      : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY         : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY      : chr  &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADFAMPRADI&quot; ...
##  $ CENTER        : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP            : num  87654 87657 87650 87650 87663 ...
##  $ IND           : num  1 1 110 106 1 ...
##  $ REFCTR        : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE     : POSIXct, format: &quot;2018-03-19&quot; &quot;2018-04-17&quot; ...
##  $ EXAMINER      : chr  &quot;avg55&quot; &quot;axr1589&quot; &quot;axr1589&quot; &quot;axr1589&quot; ...
##  $ DATE_OF_BIRTH : POSIXct, format: &quot;1933-06-05&quot; &quot;1947-04-23&quot; ...
##  $ AGE_AT_EXAM   : num  84 70 86 82 87 85 77 75 80 74 ...
##  $ NPIQINF       : chr  &quot;2&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##  $ NPIQINF_PRO   : chr  NA NA NA NA ...
##  $ NPIQINF_OTH   : chr  NA NA NA NA ...
##  $ NPIQINFA      : num  1 1 1 1 1 1 1 1 1 0 ...
##  $ NPIQINFB      : num  3 3 3 3 3 3 3 3 3 3 ...
##  $ NPIQTYPE      : num  2 1 1 1 1 2 1 1 1 1 ...
##  $ AGIT          : num  1 0 0 0 0 0 0 1 0 1 ...
##  $ AGITSEV       : num  1 NA NA NA NA NA NA 2 NA 1 ...
##  $ AGITATION_DIST: num  NA NA NA NA NA NA NA 5 NA 1 ...
##  $ DEPD          : num  1 0 0 0 0 1 0 0 1 0 ...
##  $ DEPDSEV       : num  1 NA NA NA NA 3 NA NA 2 NA ...
##  $ DEPRESS_DIST  : num  NA NA NA NA NA 5 NA NA 2 NA ...
##  $ ANX           : num  0 0 0 0 0 0 0 0 0 1 ...
##  $ ANXSEV        : num  NA NA NA NA NA NA NA NA NA 2 ...
##  $ ANXIETY_DIST  : num  NA NA NA NA NA NA NA NA NA 4 ...
##  $ ELAT          : num  0 0 0 0 0 0 0 1 0 0 ...
##  $ ELATSEV       : num  NA NA NA NA NA NA NA 1 NA NA ...
##  $ ELATION_DIST  : num  NA NA NA NA NA NA NA 0 NA NA ...
##  $ APA           : num  0 0 0 0 1 0 0 0 1 0 ...
##  $ APASEV        : num  NA NA NA NA 3 NA NA NA 2 NA ...
##  $ APATHY_DIST   : num  NA NA NA NA 0 NA NA NA 2 NA ...
##  $ DISN          : num  0 0 0 0 0 0 0 1 0 1 ...
##  $ DISNSEV       : num  NA NA NA NA NA NA NA NA NA 2 ...
##  $ DISINHIB_DIST : num  NA NA NA NA NA NA NA NA NA 0 ...
##  $ IRR           : num  0 0 0 0 0 0 0 1 0 1 ...
##  $ IRRSEV        : num  NA NA NA NA NA NA NA 3 NA 2 ...
##  $ IRRIT_DIST    : num  NA NA NA NA NA NA NA 5 NA 5 ...
##  $ MOT           : num  1 0 0 0 0 0 0 0 0 1 ...
##  $ MOTSEV        : num  1 NA NA NA NA NA NA NA NA 3 ...
##  $ MOTOR_DIST    : num  NA NA NA NA NA NA NA NA NA 0 ...
##  $ NITE          : num  0 1 0 0 0 0 0 0 0 1 ...
##  $ NITESEV       : num  NA 2 NA NA NA NA NA NA NA 1 ...
##  $ NIGHTTIME_DIST: num  NA 2 NA NA NA NA NA NA NA 0 ...
##  $ APP           : num  1 1 1 0 1 0 0 0 0 1 ...
##  $ APPSEV        : num  2 2 1 NA 3 NA NA NA NA 3 ...
##  $ APPETITE_DIST : num  NA 0 0 NA 5 NA NA NA NA 2 ...
##  $ DEL           : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ DELSEV        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DELUSION_DIST : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PARA          : num  0 0 0 0 0 0 NA NA NA 0 ...
##  $ PARAC         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PARAB         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PARAD         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ HALL          : num  1 1 0 0 0 0 0 0 0 0 ...
##  $ HALLSEV       : num  1 1 NA NA NA NA NA NA NA NA ...
##  $ HALLUCIN_DIST : num  NA 0 NA NA NA NA NA NA NA NA ...
##  $ AUDHALL       : num  4 1 0 0 8 0 NA NA NA 0 ...
##  $ AUDHALLC      : num  NA NA NA NA 9 NA NA NA NA NA ...
##  $ AUDHALLB      : num  1 1 NA NA 1 NA NA NA NA NA ...
##  $ AUDHALLD      : num  0 0 NA NA 0 NA NA NA NA NA ...
##  $ VISHALL       : num  0 1 NA NA 8 9 NA NA NA NA ...
##  $ VISHALLB      : num  NA 1 NA NA 1 NA NA NA NA NA ...
##  $ VISHALLC      : num  NA NA NA NA 9 NA NA NA NA NA ...
##  $ VISHALLD      : num  NA 0 NA NA 0 NA NA NA NA NA ...
##  $ MISIDP        : num  2 0 9 9 9 9 NA NA NA 9 ...
##  $ MISIDPB       : num  1 NA NA NA NA NA NA NA NA NA ...
##  $ MISIDPC       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MISIDPD       : num  0 NA NA NA NA NA NA NA NA NA ...
##  $ MISIDSEL      : num  0 0 9 9 9 9 NA NA NA 0 ...
##  $ MISIDSB       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MISIDSC       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MISIDSD       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MISIDT        : num  4 0 9 9 9 9 NA NA NA 0 ...
##  $ MISIDTB       : num  1 NA NA NA NA NA NA NA NA NA ...
##  $ MISIDTC       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MISIDTD       : num  0 NA NA NA NA NA NA NA NA NA ...
##  $ INFID         : num  0 0 9 9 9 9 NA NA NA 9 ...
##  $ INFIDB        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ INFIDC        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ INFIDD        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ABND          : num  0 0 9 9 9 9 NA NA NA 0 ...
##  $ ABNDB         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ABNDC         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ABNDD         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ IMP           : num  0 0 9 9 9 9 NA NA NA 0 ...
##  $ IMPB          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ IMPC          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ IMPD          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ TVR           : num  0 0 9 9 9 9 NA NA NA 0 ...
##  $ TVRB          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ TVRC          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ TVRD          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ OPIH          : num  4 0 9 9 9 9 NA NA NA 0 ...
##  $ OPIHB         : num  1 NA NA NA NA NA NA NA NA NA ...
##  $ OPIHC         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ OPIHD         : num  0 NA NA NA NA NA NA NA NA NA ...
##  $ DPSA          : num  4 0 9 9 9 9 NA NA NA 0 ...
##  $ DPSAB         : num  9 NA NA NA NA NA NA NA NA NA ...
##  $ DPSAC         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ DPSAD         : num  0 NA NA NA NA NA NA NA NA NA ...
##  $ HNH           : num  2 0 9 9 9 9 NA NA NA 0 ...
##  $ HNHB          : num  1 NA NA NA NA NA NA NA NA NA ...
##  $ HNHC          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ HNHD          : num  0 NA NA NA NA NA NA NA NA NA ...
##  $ INTQUAL       : num  0 0 0 0 0 0 NA NA NA 0 ...
##  $ NOTES         : chr  NA NA NA NA ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-12" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_NPIQ_CBRS&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-11" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## REFCTR 

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 1 × 2
##   VarNames `Data Type`
##   &lt;chr&gt;    &lt;chr&gt;      
## 1 REFCTR   VARCHAR2(6)</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;CHAR&quot;, dfDD$`Data Type`)]

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-11" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot;

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH
## 1 2018-03-19    1933-06-05
## 2 2018-04-17    1947-04-23
## 3 2018-04-03    1931-07-01
## 4 2018-04-03    1935-05-25
## 5 2018-04-24    1930-06-19
## 6 2018-04-25    1933-03-11</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-11" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 11 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-f33efe1f417eef27126b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f33efe1f417eef27126b">{"x":{"filter":"none","vertical":false,"data":[["EXAMINER","NPIQINF"],["EXAMINER","NPIQINF"],["avg55, axr1589, v.rodriguez4, kxc672, prm72, sjt82, mxc2207, mxp1257, bxf258, jjs2031, cmanrique","2  3  6, 2  7, 1  2, 2  6, 2  4"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore NPIQINF, since it can be multiple values as specified in the DD</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-11" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 103 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>##  [1] NA                                      
##  [2] &quot;1 thru 99999;&quot;                         
##  [3] &quot;1 thru 9999;&quot;                          
##  [4] &quot;0;\r\n1;&quot;                              
##  [5] &quot;1;\r\n2;\r\n3;&quot;                        
##  [6] &quot;1;\r\n2;&quot;                              
##  [7] &quot;1;\r\n0;&quot;                              
##  [8] &quot;0;\r\n1;\r\n2;\r\n3;\r\n4;\r\n5;&quot;      
##  [9] &quot;1;\r\n2;\r\n3;\r\n4;\r\n9;\r\n0;\r\n8;&quot;
## [10] &quot;1;\r\n2;\r\n3;\r\n4;\r\n9;&quot;            
## [11] &quot;0;\r\n1;\r\n9;&quot;                        
## [12] &quot;0;\r\n1;\r\n2;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-c86c4d0a070286c10862" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c86c4d0a070286c10862">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104460"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-11" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_NPIQ_CBRS &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_rpfq" class="section level2">
<h2>ALZ_RPFQ</h2>
<pre class="r"><code>df &lt;- ALZ_RPFQ

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    132 obs. of  67 variables:
##  $ SYSXM              : num  7895173 8010153 8011643 8012863 8001143 ...
##  $ SYSIND             : num  11218613 11109763 11447143 11458753 11248653 ...
##  $ SYSGP              : num  7928123 7921113 7968293 7974313 7931713 ...
##  $ SYSGPSTUDY         : num  1366233 1359223 1413403 1419423 1370023 ...
##  $ SYSINDGP           : num  7981883 7869283 8216213 8227823 8012383 ...
##  $ CGI_ORDER          : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER          : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER       : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY             : chr  &quot;ADCRLPRADI&quot; &quot;ADCONTROL&quot; &quot;ADCONTROL&quot; &quot;ADCONTROL&quot; ...
##  $ DB_OWNER           : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY              : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY           : chr  &quot;ADCRLPRADI&quot; &quot;ADCONTROL&quot; &quot;ADCONTROL&quot; &quot;ADCONTROL&quot; ...
##  $ CENTER             : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP                 : num  87998 87788 88462 88466 88118 ...
##  $ IND                : num  1 1 100 1 1 1 115 100 1 1 ...
##  $ REFCTR             : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE          : POSIXct, format: &quot;2021-02-01&quot; &quot;2021-11-15&quot; ...
##  $ EXAMINER           : chr  &quot;sjt82&quot; &quot;jjs2031&quot; &quot;jjs2031&quot; &quot;mxc2207&quot; ...
##  $ DATE_OF_BIRTH      : POSIXct, format: &quot;1943-09-22&quot; &quot;1956-12-21&quot; ...
##  $ AGE_AT_EXAM        : num  77 64 70 72 77 63 76 72 83 71 ...
##  $ REVIEW_DATE        : logi  NA NA NA NA NA NA ...
##  $ REVIEWER           : logi  NA NA NA NA NA NA ...
##  $ SMOKE              : num  2 1 1 1 1 2 2 1 2 1 ...
##  $ SMOKE_AGE_START    : num  NA 15 15 16 12 NA NA 18 NA 20 ...
##  $ SMOKE_CURR         : num  NA 2 2 2 2 NA NA 2 NA 2 ...
##  $ SMOKE_AGE_STOP     : num  NA 64 40 68 73 NA NA 40 NA 50 ...
##  $ PREGNANCIES        : num  NA NA 6 2 NA NA 1 NA NA NA ...
##  $ LIVE_KIDS          : num  NA NA 4 2 NA NA 1 NA NA NA ...
##  $ HRT                : num  NA NA 2 2 NA NA 2 NA 9 NA ...
##  $ HRT_AGE_START      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ HRT_AGE_STOP       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ HRT_YEARS          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ HYSTERECTOMY       : num  NA NA 2 1 NA NA 2 NA 9 NA ...
##  $ HYSTERECTOMY_AGE   : num  NA NA NA 48 NA NA NA NA NA NA ...
##  $ OVARIES_RMV        : num  NA NA 2 2 NA NA 2 NA 9 NA ...
##  $ OVARIES_RMV_AGE    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ OVARIES_RMV_BOTH   : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ HRT_OVR_RMV        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ PHYSICAL_ACTIVITIES: num  NA 1 0 0 0 1 0 0 0 0 ...
##  $ NOPA_REASON        : num  NA NA 2 0 1 NA 0 1 1 1 ...
##  $ VA_PAST2W          : num  NA 0 0 0 0 0 0 0 NA 1 ...
##  $ VA_PAST2W_TIMES    : num  NA NA NA NA NA NA NA NA NA 1 ...
##  $ VA_PAST2W_MINS     : num  NA NA NA NA NA NA NA NA NA 60 ...
##  $ MA_PAST2W          : num  NA 0 0 0 0 0 0 0 NA 0 ...
##  $ MA_PAST2W_TIMES    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ MA_PAST2W_MINS     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ LA_PAST2W          : num  NA 1 0 0 0 1 0 0 NA 1 ...
##  $ LA_PAST2W_TIMES    : num  NA 2 NA NA NA 14 NA NA NA 1 ...
##  $ LA_PAST2W_MINS     : num  NA 15 NA NA NA 30 NA NA NA 60 ...
##  $ VA_AR13            : num  NA 1 0 1 1 1 0 0 NA 1 ...
##  $ VA_AR13_LEVEL      : chr  NA &quot;V&quot; NA &quot;A&quot; ...
##  $ MA_AR13            : num  NA 1 1 1 1 1 0 0 NA 1 ...
##  $ MA_AR13_LEVEL      : chr  NA &quot;V&quot; &quot;V&quot; &quot;A&quot; ...
##  $ LA_AR13            : num  NA 1 1 1 1 1 0 0 NA 1 ...
##  $ LA_AR13_LEVEL      : chr  NA &quot;V&quot; &quot;V&quot; &quot;A&quot; ...
##  $ VA_AR24            : num  NA 0 0 1 1 0 0 0 NA 1 ...
##  $ VA_AR24_LEVEL      : chr  NA NA NA &quot;V&quot; ...
##  $ MA_AR24            : num  NA 1 1 1 1 0 0 0 NA 1 ...
##  $ MA_AR24_LEVEL      : chr  NA &quot;F&quot; &quot;V&quot; &quot;V&quot; ...
##  $ LA_AR24            : num  NA 1 1 1 1 1 0 0 NA 1 ...
##  $ LA_AR24_LEVEL      : chr  NA &quot;F&quot; &quot;V&quot; &quot;V&quot; ...
##  $ VA_AR50            : num  NA 0 0 0 0 0 0 0 NA 1 ...
##  $ VA_AR50_LEVEL      : chr  NA NA NA NA ...
##  $ MA_AR50            : num  NA 0 0 0 1 0 0 0 NA 1 ...
##  $ MA_AR50_LEVEL      : chr  NA NA NA NA ...
##  $ LA_AR50            : num  NA 1 1 1 1 1 0 0 NA 1 ...
##  $ LA_AR50_LEVEL      : chr  NA &quot;V&quot; &quot;F&quot; &quot;V&quot; ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-13" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_RPFQ&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-12" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## [1] &quot;REFCTR&quot;      &quot;REVIEW_DATE&quot; &quot;REVIEWER&quot; 

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 3 × 2
##   VarNames    `Data Type`
##   &lt;chr&gt;       &lt;chr&gt;      
## 1 REFCTR      VARCHAR2(6)
## 2 REVIEW_DATE date       
## 3 REVIEWER    VARCHAR</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;CHAR&quot;, dfDD$`Data Type`)]
convert2date &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;date&quot;, dfDD$`Data Type`)]

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)
df[convert2date] &lt;- lapply(df[convert2date], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-12" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot;

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## REVIEW_DATE, ignore it, it has been corrected in previous step</code></pre>
<pre><code>## [1] &quot;REVIEW_DATE&quot;</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH
## 1 2021-02-01    1943-09-22
## 2 2021-11-15    1956-12-21
## 3 2021-08-18    1951-03-04
## 4 2021-12-06    1949-06-04
## 5 2021-09-09    1944-01-03
## 6 2021-11-15    1958-03-03</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-12" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 17 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-2de3acf374293ba610d7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2de3acf374293ba610d7">{"x":{"filter":"none","vertical":false,"data":[["EXAMINER"],["EXAMINER"],["sjt82, jjs2031, mxc2207, axl4132, mxp1257, jmv184, Maricarmen Contreras, cmanrique"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore EXAMINER</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-12" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 47 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA                                 &quot;1 thru 99999;&quot;                   
## [3] &quot;1 thru 9999;&quot;                     &quot;1;\r\n2;\r\n9;&quot;                  
## [5] &quot;0;\r\n1;\r\n9;&quot;                   &quot;0;\r\n1;\r\n2;\r\n3;\r\n4;\r\n5;&quot;
## [7] &quot;0;\r\n1;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-8d7f2c634285199bd61a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8d7f2c634285199bd61a">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104411, 104408, 104445, 104427, 104406, 104415, 104431, 104407, 104432, 104439, 104442, 104530, 104403, 104404"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-12" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_RPFQ &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_screening" class="section level2">
<h2>ALZ_SCREENING</h2>
<pre class="r"><code>df &lt;- ALZ_SCREENING

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    279 obs. of  49 variables:
##  $ SYSXM            : num  7178373 7178243 7178253 7178263 7178273 ...
##  $ SYSIND           : num  1.1e+07 1.1e+07 1.1e+07 1.1e+07 1.1e+07 ...
##  $ SYSGP            : num  7894403 7894393 7896003 7896013 7896093 ...
##  $ SYSGPSTUDY       : num  1309723 1309713 1311323 1311333 1311413 ...
##  $ SYSINDGP         : num  7793363 7793333 7795173 7795203 7795323 ...
##  $ CGI_ORDER        : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER        : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER     : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY           : chr  &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ DB_OWNER         : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY            : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY         : chr  &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; ...
##  $ CENTER           : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP               : num  87648 87503 87504 87505 87512 ...
##  $ IND              : num  101 1 1 9000 1 ...
##  $ REFCTR           : logi  NA NA NA NA NA NA ...
##  $ FORM_DATE        : POSIXct, format: &quot;2017-07-18&quot; &quot;2017-07-14&quot; ...
##  $ FILLED_OUT_BY    : chr  &quot;axr1589&quot; &quot;axr1589&quot; &quot;axr1589&quot; &quot;axr1589&quot; ...
##  $ DATE_OF_BIRTH    : POSIXct, format: &quot;1948-02-01&quot; &quot;1939-01-13&quot; ...
##  $ LUMBAR_YES_NO    : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ LUMBAR_DATE      : POSIXct, format: NA NA ...
##  $ LUMBAR_NO_DATE   : chr  NA NA NA NA ...
##  $ LUMBAR_PUNCTURE  : chr  NA NA NA NA ...
##  $ BRAIN_MRI_YES_NO : chr  &quot;N&quot; &quot;Y&quot; &quot;N&quot; &quot;N&quot; ...
##  $ BRAIN_MRI_DATE   : POSIXct, format: NA NA ...
##  $ BRAIN_MRI_NO_DATE: chr  NA NA NA NA ...
##  $ BRAIN_MRI        : chr  NA &quot;NL&quot; NA NA ...
##  $ BRAIN_CT_YES_NO  : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ BRAIN_CT_DATE    : POSIXct, format: NA NA ...
##  $ BRAIN_CT_NO_DATE : chr  NA NA NA NA ...
##  $ BRAIN_CT         : chr  NA NA NA NA ...
##  $ EEG_YES_NO       : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ EEG_DATE         : POSIXct, format: NA NA ...
##  $ EEG_NO_DATE      : chr  NA NA NA NA ...
##  $ EEG              : chr  NA NA NA NA ...
##  $ PET_SP_YES_NO    : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ PET_SP_DATE      : POSIXct, format: NA NA ...
##  $ PET_SP_NO_DATE   : chr  NA NA NA NA ...
##  $ PET_SP           : chr  NA NA NA NA ...
##  $ BRAIN_BIO_YES_NO : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ BRAIN_BIO_DATE   : logi  NA NA NA NA NA NA ...
##  $ BRAIN_BIO_NO_DATE: logi  NA NA NA NA NA NA ...
##  $ BRAIN_BIO        : logi  NA NA NA NA NA NA ...
##  $ LUMB_NOTES       : logi  NA NA NA NA NA NA ...
##  $ BRNMRI_NOTES     : logi  NA NA NA NA NA NA ...
##  $ BRNCT_NOTES      : logi  NA NA NA NA NA NA ...
##  $ EEG_NOTES        : logi  NA NA NA NA NA NA ...
##  $ PETSP_NOTES      : logi  NA NA NA NA NA NA ...
##  $ BRNBIO_NOTES     : logi  NA NA NA NA NA NA ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-14" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_SCREENING&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-13" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## 10 vars

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 10 × 2
##    VarNames          `Data Type`   
##    &lt;chr&gt;             &lt;chr&gt;         
##  1 REFCTR            VARCHAR2(6)   
##  2 BRAIN_BIO_DATE    DATE          
##  3 BRAIN_BIO_NO_DATE CHAR(2)       
##  4 BRAIN_BIO         CHAR(2)       
##  5 LUMB_NOTES        VARCHAR2(4000)
##  6 BRNMRI_NOTES      VARCHAR2(4000)
##  7 BRNCT_NOTES       VARCHAR2(4000)
##  8 EEG_NOTES         VARCHAR2(4000)
##  9 PETSP_NOTES       VARCHAR2(4000)
## 10 BRNBIO_NOTES      VARCHAR2(4000)</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;CHAR&quot;, dfDD$`Data Type`)]
convert2date &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;DATE&quot;, dfDD$`Data Type`)]

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)
df[convert2date] &lt;- lapply(df[convert2date], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-13" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;FORM_DATE&quot;      &quot;DATE_OF_BIRTH&quot;  &quot;LUMBAR_DATE&quot;    &quot;BRAIN_MRI_DATE&quot; &quot;BRAIN_CT_DATE&quot;  &quot;EEG_DATE&quot;       &quot;PET_SP_DATE&quot;  

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## &quot;BRAIN_BIO_DATE&quot;, ignore it, it has been corrected in previous step</code></pre>
<pre><code>## [1] &quot;BRAIN_BIO_DATE&quot;</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    FORM_DATE DATE_OF_BIRTH LUMBAR_DATE BRAIN_MRI_DATE BRAIN_CT_DATE EEG_DATE
## 1 2017-07-18    1948-02-01        &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;     &lt;NA&gt;
## 2 2017-07-14    1939-01-13        &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;     &lt;NA&gt;
## 3 2017-07-14    1944-10-03        &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;     &lt;NA&gt;
## 4 2017-07-14    1960-10-23        &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;     &lt;NA&gt;
## 5 2017-07-14    1940-11-18        &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;     &lt;NA&gt;
## 6 2017-07-14    1946-10-04        &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;     &lt;NA&gt;
##   PET_SP_DATE
## 1        &lt;NA&gt;
## 2        &lt;NA&gt;
## 3        &lt;NA&gt;
## 4        &lt;NA&gt;
## 5        &lt;NA&gt;
## 6        &lt;NA&gt;</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-13" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 31 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-f62dbae4693a3f93643d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f62dbae4693a3f93643d">{"x":{"filter":"none","vertical":false,"data":[["FILLED_OUT_BY"],["FILLED_OUT_BY"],["axr1589, v.rodriguez4, avg55, ALEJANDRA BETACOURT, bxf258, sjt82, prm72, kxc672, ascott2, patricia manrique, patricia, mxc2207, fxs121, jjs2031, axl4132, jmv184, gsv32, cmanrique"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore FILLED_OUT_BY</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-13" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 10 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA              &quot;1 thru 99999;&quot; &quot;1 thru 9999;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-d80771663f61ae3aeeca" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d80771663f61ae3aeeca">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104477, 104415, 104410, 104456, 104557, 104403, 104404, 104705"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-13" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_SCREENING &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_screening_rc" class="section level2">
<h2>ALZ_SCREENING_RC</h2>
<pre class="r"><code>df &lt;- ALZ_SCREENING_RC

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    556 obs. of  61 variables:
##  $ SYSXM             : num  8258773 8258813 8260093 8277633 8278003 ...
##  $ SYSIND            : num  11037673 11369813 11362953 11638763 11621333 ...
##  $ SYSGP             : num  7894423 7952013 7946353 8007323 8006293 ...
##  $ SYSGPSTUDY        : num  1309743 1397123 1387463 1454033 1453003 ...
##  $ SYSINDGP          : num  7793413 8139083 8132223 8407833 8390403 ...
##  $ CGI_ORDER         : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER         : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER      : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY            : chr  &quot;ADFAMPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADCONTROL&quot; ...
##  $ DB_OWNER          : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY             : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY          : chr  &quot;ADFAMPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADFAMPRADI&quot; &quot;ADCONTROL&quot; ...
##  $ CENTER            : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP                : num  87650 88301 87545 104540 104528 ...
##  $ IND               : num  9000 1 106 1 1 ...
##  $ REFCTR            : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE         : POSIXct, format: &quot;2023-10-24&quot; &quot;2024-02-13&quot; ...
##  $ EXAMINER          : chr  &quot;gsv32&quot; &quot;jjs2031&quot; &quot;jjs2031&quot; &quot;gsv32&quot; ...
##  $ DATE_OF_BIRTH     : POSIXct, format: &quot;1954-10-29&quot; &quot;1947-05-13&quot; ...
##  $ AGE_AT_EXAM       : num  68 76 66 86 86 67 60 81 77 62 ...
##  $ REVIEW_DATE       : logi  NA NA NA NA NA NA ...
##  $ REVIEWER          : logi  NA NA NA NA NA NA ...
##  $ LUMB_YN           : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ LUMB_DT           : POSIXct, format: NA NA ...
##  $ LUMB_PUNC         : chr  NA NA NA NA ...
##  $ LUMB_NOTES        : chr  NA NA NA NA ...
##  $ BRNMRI_YN         : chr  &quot;Y&quot; &quot;N&quot; &quot;Y&quot; &quot;N&quot; ...
##  $ BRNMRI_DT         : POSIXct, format: &quot;2017-10-01&quot; NA ...
##  $ BRAIN_MRI         : chr  &quot;NL&quot; NA &quot;AC&quot; NA ...
##  $ BRNMRI_NOTES      : chr  NA NA &quot;NO DATE AVAILABLE&quot; NA ...
##  $ BRNCT_YN          : chr  &quot;Y&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ BRNCT_DT          : POSIXct, format: &quot;2017-10-01&quot; NA ...
##  $ BRAIN_CT          : chr  &quot;NL&quot; NA NA NA ...
##  $ BRNCT_NOTES       : chr  NA NA NA NA ...
##  $ EEG_YN            : chr  &quot;Y&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ EEG_DT            : POSIXct, format: &quot;2017-10-01&quot; NA ...
##  $ EEG               : chr  &quot;NL&quot; NA NA NA ...
##  $ EEG_NOTES         : chr  NA NA NA NA ...
##  $ PETSP_YN          : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ PETSP_DT          : POSIXct, format: NA NA ...
##  $ PET_SPECT         : chr  NA NA NA NA ...
##  $ PETSP_NOTES       : chr  NA NA NA NA ...
##  $ BRNBIO_YN         : chr  &quot;N&quot; &quot;N&quot; &quot;N&quot; &quot;N&quot; ...
##  $ BRNBIO_DT         : logi  NA NA NA NA NA NA ...
##  $ BRAIN_BIO         : logi  NA NA NA NA NA NA ...
##  $ BRNBIO_NOTES      : logi  NA NA NA NA NA NA ...
##  $ PRIOR_SCORE_MMSE1 : logi  NA NA NA NA NA NA ...
##  $ DATE_MMSE1        : logi  NA NA NA NA NA NA ...
##  $ PRIOR_SCORE_MOCA1 : logi  NA NA NA NA NA NA ...
##  $ DATE_MOCA1        : logi  NA NA NA NA NA NA ...
##  $ PRIOR_SC_BROOKE1  : logi  NA NA NA NA NA NA ...
##  $ DATE_BROOKE1      : logi  NA NA NA NA NA NA ...
##  $ PRIOR_SC_CHIF1    : logi  NA NA NA NA NA NA ...
##  $ DATE_CHIF1        : logi  NA NA NA NA NA NA ...
##  $ PRIOR_SC_WORDLIST1: logi  NA NA NA NA NA NA ...
##  $ DATE_WORDLIST1    : logi  NA NA NA NA NA NA ...
##  $ OTHER_TEST1       : logi  NA NA NA NA NA NA ...
##  $ DATE_OTHER_TEST1  : logi  NA NA NA NA NA NA ...
##  $ PRIOR_CLASSIF1    : logi  NA NA NA NA NA NA ...
##  $ PRIOR_ASSESS_NOTE1: logi  NA NA NA NA NA NA ...
##  $ NOTE_ALZ_SCREEN   : chr  NA NA NA NA ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-15" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;ALZ_SCREENING_RC&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-14" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## 20 vars

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 20 × 2
##    VarNames           `Data Type`   
##    &lt;chr&gt;              &lt;chr&gt;         
##  1 REFCTR             VARCHAR2(6)   
##  2 REVIEW_DATE        date          
##  3 REVIEWER           VARCHAR       
##  4 BRNBIO_DT          DATE          
##  5 BRAIN_BIO          CHAR(2)       
##  6 BRNBIO_NOTES       VARCHAR2(4000)
##  7 PRIOR_SCORE_MMSE1  NUMBER(3)     
##  8 DATE_MMSE1         DATE          
##  9 PRIOR_SCORE_MOCA1  NUMBER(3)     
## 10 DATE_MOCA1         DATE          
## 11 PRIOR_SC_BROOKE1   NUMBER(3)     
## 12 DATE_BROOKE1       DATE          
## 13 PRIOR_SC_CHIF1     NUMBER(3)     
## 14 DATE_CHIF1         DATE          
## 15 PRIOR_SC_WORDLIST1 NUMBER(3)     
## 16 DATE_WORDLIST1     DATE          
## 17 OTHER_TEST1        NUMBER(3)     
## 18 DATE_OTHER_TEST1   DATE          
## 19 PRIOR_CLASSIF1     VARCHAR2(50)  
## 20 PRIOR_ASSESS_NOTE1 VARCHAR2(150)</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;CHAR&quot;, dfDD$`Data Type`,,ignore.case = T)] ## 6 vars
convert2date &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;date&quot;, dfDD$`Data Type`,ignore.case = T)] ## 8 vars
convert2num &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;NUMBER&quot;, dfDD$`Data Type`,ignore.case = T)] ## 6 vars

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)
df[convert2date] &lt;- lapply(df[convert2date], as.Date)
df[convert2num] &lt;- lapply(df[convert2chr], as.numeric)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-14" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot; &quot;LUMB_DT&quot;       &quot;BRNMRI_DT&quot;     &quot;BRNCT_DT&quot;      &quot;EEG_DT&quot;        &quot;PETSP_DT&quot; 

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols)</code></pre>
<pre><code>## [1] &quot;REVIEW_DATE&quot;      &quot;BRNBIO_DT&quot;        &quot;DATE_MMSE1&quot;       &quot;DATE_MOCA1&quot;      
## [5] &quot;DATE_BROOKE1&quot;     &quot;DATE_CHIF1&quot;       &quot;DATE_WORDLIST1&quot;   &quot;DATE_OTHER_TEST1&quot;</code></pre>
<pre class="r"><code># [1] &quot;REVIEW_DATE&quot;      &quot;BRNBIO_DT&quot;        &quot;DATE_MMSE1&quot;       &quot;DATE_MOCA1&quot;       &quot;DATE_BROOKE1&quot;     &quot;DATE_CHIF1&quot;      
# [7] &quot;DATE_WORDLIST1&quot;   &quot;DATE_OTHER_TEST1&quot;
## these variables have been corrected in previous step

head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH LUMB_DT  BRNMRI_DT   BRNCT_DT     EEG_DT PETSP_DT
## 1 2023-10-24    1954-10-29    &lt;NA&gt; 2017-10-01 2017-10-01 2017-10-01     &lt;NA&gt;
## 2 2024-02-13    1947-05-13    &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;
## 3 2024-02-20    1957-08-05    &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;
## 4 2023-09-13    1937-08-13    &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;
## 5 2023-05-09    1936-05-22    &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;
## 6 2023-08-16    1956-01-09    &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-14" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 29 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-cf46c628929c1a759fad" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cf46c628929c1a759fad">{"x":{"filter":"none","vertical":false,"data":[["EXAMINER"],["EXAMINER"],["gsv32, jjs2031, cmanrique, sjt82, kxc672, mxp1257, mxl2473, v.rodriguez4, cxc2077, smm493, Katalina McInerney, axl4418, Izri Martinez, prm72, Anisley Martinez, eir34, ABIGAIL LOPEZ, Katalina Fernandez M, bxf258, lxi119"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore EXAMINER</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-14" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 17 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA              &quot;1 thru 99999;&quot; &quot;1 thru 9999;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-2cbc74c193e886f600a1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2cbc74c193e886f600a1">{"x":{"filter":"none","vertical":false,"data":[["GP"],["GP"],["104540, 104528, 104519, 104455, 104511, 104548, 104549, 104459, 104452, 104531, 104497, 104521, 104487, 104496, 104525, 104472, 104515, 104508, 104490, 104453, 104513, 104499, 104500, 104536, 104518, 104454, 104514, 104554, 104481, 105805, 104475, 104526, 104539, 104527, 104466, 104556, 104532, 104552, 104463, 104512, 104469, 105806, 104457, 104464, 104529, 104516, 104476, 104530, 104502, 105801, 104458, 104470, 104553, 105817, 104569, 104482, 105821, 105818, 104589, 105827, 104565, 105820, 104557, 104564, 104535, 105809, 104560, 104574, 104542, 104461, 105815, 105807, 105808, 105803, 105814, 104507, 104578, 104586, 104467, 104582, 104447, 104585, 104550, 104573, 105824, 104468, 104547, 104545, 104570, 104583, 105811, 104485, 104450, 104559, 104546, 104555, 104590, 104591, 104568, 104506, 104551, 104544, 104571, 104473, 104483, 105813, 104494, 104563, 104484, 105822, 104572, 104495, 105826, 104524, 104489, 104462, 104479, 104523, 104488, 104509, 104505, 104579, 104448, 104534, 104566, 104465, 105812, 104562, 104580, 104581, 104584, 104541, 104533, 105810, 104451, 104498, 104510, 104449, 104575, 104474, 104561, 104520, 105800, 105816, 104480, 105825, 105823, 104478, 104486, 104594, 104654, 104662, 104661, 104652, 104666, 104632, 104626, 104656, 104659, 104660, 104658, 104614, 104588, 104623, 104664, 104629, 104657, 104634, 104599, 104616, 104610, 104621, 104617, 104684, 104679, 104697, 104619, 104612, 104501, 105829, 104638, 104655, 104640, 104643, 104602, 104639, 104645, 104685, 104681, 104503, 104522, 104665, 105830, 104456, 104597, 104669, 104618, 104624, 105832, 104595, 104538, 104504, 104537, 104648, 104672, 105833, 105834, 104650, 104558, 104517, 104667, 104604, 104701, 104688, 104593, 104689, 105828, 104663, 104686, 104630, 104611, 104644, 104646, 104615, 104605, 104606, 104622, 104683, 104647, 104608, 104696, 104677, 104699, 104631, 105831, 104680, 104642, 104598, 104600, 104596, 104637, 104543, 104620, 104668, 104651, 104609, 104607, 104673, 104682, 104674, 104592, 104401, 104641, 104649, 104712, 104714, 104711, 104613, 105838, 104708, 104704, 104713, 104710, 104724, 104725, 104720, 104723, 104735, 104675, 104676, 104781, 104785, 104775, 104718, 104719, 104717, 104736, 104743, 104742, 104761, 104740, 104744, 104769, 104765, 104754, 104752, 104758, 104766, 104762, 104770, 104771, 104627, 104747, 104628, 104727, 104721, 104728, 104726, 104700, 104734, 104715, 104706, 104746, 104722, 104730, 104690, 104774, 104778, 104695, 104748, 104738, 104737, 104751, 104703, 104731, 104729, 104768, 104764, 104777, 104763, 104776, 104625, 104603, 104702"],["1 - 99999"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-14" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_ALZ_SCREENING_RC &lt;- df</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="alz_stick_d_rc" class="section level2">
<h2>ALZ_STICK_D_RC</h2>
<p><br> <br></p>
</div>
<div id="b4_cdr_rc" class="section level2">
<h2>B4_CDR_RC</h2>
<p><br> <br></p>
</div>
<div id="b5_npiq_rc" class="section level2">
<h2>B5_NPIQ_RC</h2>
<pre class="r"><code>df &lt;- B5_NPIQ_RC

## extract all the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;logical&quot;
## 
## [[4]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<pre class="r"><code>str(df, max.level = 99, list.len = 99999)</code></pre>
<details>
<summary>
Click for details
</summary>
<pre><code>## &#39;data.frame&#39;:    305 obs. of  38 variables:
##  $ SYSXM        : num  8275943 8258983 8277543 8260623 8261293 ...
##  $ SYSIND       : num  11160523 11369813 11620763 11163453 11638403 ...
##  $ SYSGP        : num  7923793 7952013 8005723 7924953 8006953 ...
##  $ SYSGPSTUDY   : num  1361903 1397123 1452433 1363063 1453663 ...
##  $ SYSINDGP     : num  7923633 8139083 8389833 7926663 8407473 ...
##  $ CGI_ORDER    : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ GPS_ORDER    : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ STDCGI_ORDER : num  11 11 11 11 11 11 11 11 11 11 ...
##  $ LSTUDY       : chr  &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADCONTROL&quot; &quot;ADFAMPRADI&quot; ...
##  $ DB_OWNER     : chr  &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; &quot;CLINIC_USER&quot; ...
##  $ STUDY        : chr  &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; &quot;ALZ&quot; ...
##  $ SUBSTUDY     : chr  &quot;ADCRLPRADI&quot; &quot;ADCRLPRADI&quot; &quot;ADCONTROL&quot; &quot;ADFAMPRADI&quot; ...
##  $ CENTER       : chr  &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; &quot;IHG&quot; ...
##  $ GP           : num  87883 88301 104457 87923 104556 ...
##  $ IND          : num  1 1 1 9000 1 1 1 1 1 101 ...
##  $ REFCTR       : logi  NA NA NA NA NA NA ...
##  $ EXAM_DATE    : POSIXct, format: &quot;2024-02-14&quot; &quot;2024-02-13&quot; ...
##  $ EXAMINER     : chr  &quot;gsv32&quot; &quot;jjs2031&quot; &quot;sjt82&quot; &quot;gsv32&quot; ...
##  $ DATE_OF_BIRTH: POSIXct, format: &quot;1939-03-20&quot; &quot;1947-05-13&quot; ...
##  $ AGE_AT_EXAM  : num  84 76 76 56 79 71 74 64 86 70 ...
##  $ REVIEW_DATE  : logi  NA NA NA NA NA NA ...
##  $ REVIEWER     : logi  NA NA NA NA NA NA ...
##  $ NPIQINF      : num  1 2 3 3 2 2 3 1 3 3 ...
##  $ NPIQINF_OTH  : chr  NA NA &quot;center caretaker&quot; &quot;cousin&quot; ...
##  $ NPIQTYPE     : num  1 NA NA 1 NA NA 1 NA NA 1 ...
##  $ DELSEV       : num  0 0 2 0 0 0 0 0 0 0 ...
##  $ HALLSEV      : num  1 0 2 0 0 0 0 0 0 0 ...
##  $ AGITSEV      : num  0 0 0 0 0 2 0 0 1 0 ...
##  $ DEPDSEV      : num  1 0 0 1 1 2 0 0 0 0 ...
##  $ ANXSEV       : num  1 0 0 0 2 2 0 0 1 0 ...
##  $ ELATSEV      : num  0 0 0 0 0 2 0 0 1 0 ...
##  $ APASEV       : num  0 0 0 0 0 3 0 0 0 0 ...
##  $ DISNSEV      : num  0 0 0 0 0 2 0 0 0 0 ...
##  $ IRRSEV       : num  0 0 0 1 0 2 0 0 0 0 ...
##  $ MOTSEV       : num  0 0 0 0 0 2 0 0 0 0 ...
##  $ NITESEV      : num  1 0 0 0 0 1 0 0 0 0 ...
##  $ APPSEV       : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ NOTES_NPIQ   : chr  NA NA NA NA ...</code></pre>
</details>
<p><br></p>
<div id="pull-the-regenerated-dd-16" class="section level3">
<h3>Pull the regenerated DD</h3>
<pre class="r"><code>dfDD &lt;- read_excel(&quot;/Users/mengnazhang/Desktop/ADSP_DataPrep_local/PRADI/Phenotype/2025/Clean/colnamesPerSubdata.xlsx&quot;, sheet = &quot;B5_NPIQ_RC&quot;)</code></pre>
<p><br></p>
</div>
<div id="handling-logical-variables-15" class="section level3">
<h3>Handling Logical Variables</h3>
<pre class="r"><code>## extract all logical variables
logicols &lt;- colnames(df)[sapply(df, is.logical)] ## [1] &quot;REFCTR&quot;      &quot;REVIEW_DATE&quot; &quot;REVIEWER&quot; 

## view those variables in the regeneraed DD
dfDD[dfDD$VarNames %in% logicols,c(&quot;VarNames&quot;,&quot;Data Type&quot;)]</code></pre>
<pre><code>## # A tibble: 3 × 2
##   VarNames    `Data Type`
##   &lt;chr&gt;       &lt;chr&gt;      
## 1 REFCTR      VARCHAR2(6)
## 2 REVIEW_DATE date       
## 3 REVIEWER    CHAR</code></pre>
<pre class="r"><code>## converted to character
convert2chr &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;CHAR&quot;, dfDD$`Data Type`)]
convert2date &lt;- dfDD$VarNames[dfDD$VarNames %in% logicols &amp; grepl(&quot;date&quot;, dfDD$`Data Type`)]

## convert
df[convert2chr] &lt;- lapply(df[convert2chr], as.character)
df[convert2date] &lt;- lapply(df[convert2date], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [[1]]
## [1] &quot;numeric&quot;
## 
## [[2]]
## [1] &quot;character&quot;
## 
## [[3]]
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## [[4]]
## [1] &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-date-variables-15" class="section level3">
<h3>Handling Date Variables</h3>
<pre class="r"><code>## extract date variables from sub-dataset
datecols &lt;- colnames(df)[sapply(df, function(x) inherits(x, c(&quot;POSIXct&quot;, &quot;POSIXt&quot;)))]
## [1] &quot;EXAM_DATE&quot;     &quot;DATE_OF_BIRTH&quot;

## extract date variables from regenerated DD
datecolsFromDD &lt;- dfDD$VarNames[dfDD$`Data Type` %in% c(&quot;DATE&quot;,&quot;date&quot;)]

## compare the two to see if we missing any date variables
setdiff(datecols,datecolsFromDD) ## character(0)</code></pre>
<pre><code>## character(0)</code></pre>
<pre class="r"><code>setdiff(datecolsFromDD,datecols) ## REVIEW_DATE, ignore it, it has been corrected in previous step</code></pre>
<pre><code>## [1] &quot;REVIEW_DATE&quot;</code></pre>
<pre class="r"><code>head(df[,datecols])</code></pre>
<pre><code>##    EXAM_DATE DATE_OF_BIRTH
## 1 2024-02-14    1939-03-20
## 2 2024-02-13    1947-05-13
## 3 2023-04-17    1946-12-19
## 4 2023-10-25    1967-06-15
## 5 2023-09-12    1944-04-17
## 6 2023-09-12    1952-04-25</code></pre>
<pre class="r"><code>## convert format
df[datecols] &lt;- lapply(df[datecols], as.Date)

## recheck the unique data types
unique(sapply(df, class))</code></pre>
<pre><code>## [1] &quot;numeric&quot;   &quot;character&quot; &quot;Date&quot;</code></pre>
<p><br></p>
</div>
<div id="handling-character-variables-15" class="section level3">
<h3>Handling Character Variables</h3>
<pre class="r"><code>## extract characteristic variables from sub-dataset
chrcols &lt;- colnames(df)[sapply(df, is.character)] ## 10 vars

## check data type inconsistency:
## mismatchChrs_1: present as chr in data but others in the DD
## mismatchChrs_2: present as chr in DD but others in the data
chrColsfromDD &lt;- dfDD[grepl(&quot;^(varchar|char)&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Data Type&quot;)]

mismatchChrs_1 &lt;- setdiff(chrcols,chrColsfromDD$VarNames) ## character(0)
mismatchChrs_2 &lt;- setdiff(chrColsfromDD$VarNames,chrcols) ## character(0)

## extract characteristic variables with value specification
tmp &lt;- dfDD[grepl(&quot;CHAR|VARCHAR&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

## check if the unique values for the chr columns in the dataset matching with the DD
DT::datatable(check_valid_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-c5706122c1d540d75adc" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c5706122c1d540d75adc">{"x":{"filter":"none","vertical":false,"data":[["EXAMINER"],["EXAMINER"],["gsv32, jjs2031, sjt82, mxp1257, cmanrique, v.rodriguez4, bxf258, mxl2473, Katalina McInerney, prm72, ABIGAIL LOPEZ, Anisley Martinez, Katalina Fernandez M, axl4418, lxi119, eir34, smm493"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore EXAMINER</code></pre>
<p><br></p>
</div>
<div id="handling-numeric-variables-15" class="section level3">
<h3>Handling Numeric Variables</h3>
<pre class="r"><code>## extract numeric variables from sub-dataset
numcols &lt;- colnames(df)[sapply(df, is.numeric)] ## 25 vars

## extract numeric variables from DD

## check data type inconsistency:
## mismatchNums_1: present as numeric in data but others in the DD
## mismatchNums_2: present as numeric in DD but others in the data
numColsfromDD &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

mismatchNums_1 &lt;- setdiff(numcols,numColsfromDD$VarNames) ## character(0)
mismatchNums_2 &lt;- setdiff(numColsfromDD$VarNames,numcols) ## character(0)

unique(numColsfromDD$`Valid Responses`)</code></pre>
<pre><code>## [1] NA                                      
## [2] &quot;1 thru 99999;&quot;                         
## [3] &quot;1 thru 9999;&quot;                          
## [4] &quot;1;\r\n2;\r\n3;\r\n4;\r\n5;\r\n6;\r\n7;&quot;
## [5] &quot;1;\r\n2;&quot;                              
## [6] &quot;1;\r\n2;\r\n3;&quot;</code></pre>
<pre class="r"><code>tmp &lt;- dfDD[grepl(&quot;number&quot;, dfDD$`Data Type`, ignore.case = TRUE) &amp; !is.na(dfDD$`Valid Responses`),c(&quot;VarNames&quot;,&quot;Valid Responses&quot;)]

DT::datatable(check_valid_numeric_responses(tmp,df))</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-6d2a09e3e716c3854f94" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6d2a09e3e716c3854f94">{"x":{"filter":"none","vertical":false,"data":[["GP","DELSEV","HALLSEV","AGITSEV","DEPDSEV","ANXSEV","ELATSEV","APASEV","DISNSEV","IRRSEV","MOTSEV","NITESEV","APPSEV"],["GP","DELSEV","HALLSEV","AGITSEV","DEPDSEV","ANXSEV","ELATSEV","APASEV","DISNSEV","IRRSEV","MOTSEV","NITESEV","APPSEV"],["104457, 104556, 104552, 104452, 104518, 104472, 105801, 104496, 105806, 104490, 104554, 104460, 104475, 104532, 104463, 104466, 104459, 104529, 104481, 104464, 105803, 105817, 105827, 104572, 104542, 104461, 105807, 105815, 104519, 105808, 104578, 105809, 105813, 104575, 104474, 104574, 104573, 105824, 104545, 104570, 104582, 104583, 105826, 104581, 104480, 104544, 104562, 105814, 105816, 104571, 104569, 104565, 104579, 104566, 104567, 104563, 104580, 104478, 104458, 105811, 105800, 104462, 105818, 104483, 104451, 104546, 105823, 105825, 104486, 104636, 104662, 104666, 104632, 104659, 104640, 104614, 104660, 104611, 104623, 104621, 104617, 104683, 104681, 104604, 104619, 104612, 105833, 105829, 104609, 104668, 104643, 104644, 104602, 104680, 104665, 104616, 105830, 104537, 104648, 104633, 104649, 104638, 104631, 104652, 104667, 104698, 104593, 105831, 104689, 104646, 104615, 104606, 104622, 104647, 104608, 105828, 105832, 104637, 104594, 104639, 104558, 104642, 104600, 104654, 105834, 104620, 104607, 104596, 104673, 104677, 104635, 104641, 104709, 104711, 104613, 105838, 104714, 104722, 104769, 104742, 104735, 104674, 104744, 104751, 104765, 104771, 104763, 104770, 104700, 104729, 104778, 104695, 104762, 104726, 104768, 104764, 104747, 104690, 104676","0","0, 9","0, 9","0, 9","0","0, 9","0, 9","0, 9","0, 9","0, 9","0, 9","0, 9"],["1 - 99999","1;2;3","1;2;3","1;2;3","1;2;3","1;2;3","1;2;3","1;2;3","1;2;3","1;2;3","1;2;3","1;2;3","1;2;3"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>VarName<\/th>\n      <th>Invalid_Values<\/th>\n      <th>Accepted_values<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"VarName","targets":1},{"name":"Invalid_Values","targets":2},{"name":"Accepted_values","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>## ignore GP</code></pre>
<p><br></p>
</div>
<div id="save-cleaned-data-15" class="section level3">
<h3>Save Cleaned Data</h3>
<pre class="r"><code>clean_B5_NPIQ_RC &lt;- df</code></pre>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
